<!DOCTYPE html>
<html>
<head>
<!DOCTYPE html>
<html lang="en-us">



<link rel="stylesheet" href="/css/fonts.css">
<link rel="stylesheet" href="/css/main-site.css">
<link rel="stylesheet" href="/css/fa5-all.css">
<style type="text/css">
    body {
	background-color: #ffffff;
	color: #404040
}

/* Links */

a {
  color: #CA225E;
}

a:hover {
  color: #cc3168;
}

/* Landing page content bands */

#homeContent .band.first {
  background-color: #ffffff
}

#homeContent .band.second {
  background-color: #fcfcfc
}

#homeContent .band.third {
  background-color: #ffffff
}

/* Top navigation bar menu */

#rStudioHeader {
  background-color: #ffffff;
  color: black;
}

#rStudioHeader .productName {
  color: #CA225E
}

#rStudioHeader .productName:hover {
  color: #00000075
}

#rStudioHeader #menu .menuItem.a {
  background-color: #75aadb;
  color: black;
}

#rStudioHeader #menu .menuItem:hover {
  background-color: white;
  color: #CA225E;
}

#rStudioHeader #menu .menuItem.current {
  background-color: #fcfcfc;
  color: #CA225E;
  text-decoration: none;
}

/* Footer */

#rStudioFooter.band {
  background-color: #CA225E40;
}

#rStudioFooter .bandContent #copyright {
  color: #CA225E;
}

/* Tables */

table tbody tr:nth-child(even){
  background-color: #fcfcfc;
}

table tbody tr:nth-child(odd){
  background-color: #1a162d10;
}

.latest {
  border-top: .5em solid <no value>;
}
</style>

  <link rel="stylesheet" href="/css/tm.css">




<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="apple-mobile-web-app-capable" content="yes" />

<meta name="og:image" content="https://www.tidymodels.org/images/feature_summary_large_image.jpg" >

  <meta property="twitter:card" content="summary_large_image">

<meta name="twitter:image" content="https://www.tidymodels.org/images/feature_summary_large_image.jpg" ><meta name="generator" content="Hugo 0.96.0" />

<meta property="og:type" content="website"><title>Learn - K-means clustering with tidy data principles</title>
    <meta property="og:title" content="Learn - K-means clustering with tidy data principles">
    
    
    
    
    <meta property="description" content="Summarize clustering characteristics and estimate the best number of clusters for a data set.
">
    <meta property="og:description" content="Summarize clustering characteristics and estimate the best number of clusters for a data set.
">



<link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png" />
<link rel="manifest" href="/images/favicons/site.webmanifest" />
<link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" />
<link rel="shortcut icon" href="/images/favicons/favicon.ico" />
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" href="/images/favicons/browserconfig.xml" >



<script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/js/site.js"></script>


  <script type="text/javascript" src="/js/tm.js"></script>


<link rel="icon" href="/images/favicon.ico" />


<script defer data-domain="tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>



  <body>
    <div id="appTidyverseSite" class="shrinkHeader alwaysShrinkHeader">
      <div id="main">
        
        <div id="rStudioHeader">
          <div class="band">
            <div class="innards bandContent">
              <div>
                <a class="productName" href="/">Tidymodels</a>
                
              </div>
              <div id="menu">
  <div id="menuToggler"></div>
  <div id="menuItems" class="">
    
    
      
      
      
    <a class="menuItem " href="/packages/">Packages</a>
    
      
      
      
    <a class="menuItem " href="/start/">Get Started</a>
    
      
      
      
    <a class="menuItem current" href="/learn/">Learn</a>
    
      
      
      
    <a class="menuItem " href="/help/">Help</a>
    
      
      
      
    <a class="menuItem " href="/contribute/">Contribute</a>
    
      
      
      
    <a class="menuItem " href="/find/"><i class="fas fa-search fa-lg"></i> </a>
    
      
      
      
    <a class="menuItem " href="https://github.com/tidymodels/"><i class="fab fa-github fa-lg"></i></a>
    
  </div>
</div>

            </div>
          </div>
        </div>
</head>
<body>


 




<div class="band padForHeader pushFooter">
  <div class="bandContent">
    <div class="full splitColumns withMobileMargins">
      <div class="column75">
        
        <div class="section">
          <div class="sectionTitle">
            <a href="/learn/">
              <i class="fas fa-chevron-left"></i>&nbsp;Back to Learn
            </a>
          </div>
        </div>

      <h1 class="article-title">K-means clustering with tidy data principles</h1>

      
      <div class="article-header">
        </div>
        

      
      
      
      
        </p>
      
        
      <div class="learning-objective-container">
        <h2 class="learning-objective">Learning objective</h2>
        <p class="single-learning-objective-text">Summarize clustering characteristics and estimate the best number of clusters for a data set.</p>
      </div>
      

      <div class="article-content">
      <h2 id="introduction">Introduction</h2>
<p>This article only requires the tidymodels package.</p>
<p>K-means clustering serves as a useful example of applying tidy data principles to statistical analysis, and especially the distinction between the three tidying functions:</p>
<ul>
<li><code>tidy()</code></li>
<li><code>augment()</code></li>
<li><code>glance()</code></li>
</ul>
<p>Let&rsquo;s start by generating some random two-dimensional data with three clusters. Data in each cluster will come from a multivariate gaussian distribution, with different means for each cluster:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">library</span>(tidymodels)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">set.seed</span>(<span style="color:#666">27</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>centers <span style="color:#666">&lt;-</span> <span style="color:#00f">tibble</span>(
</span></span><span style="display:flex;"><span>  cluster <span style="color:#666">=</span> <span style="color:#00f">factor</span>(<span style="color:#666">1</span><span style="color:#666">:</span><span style="color:#666">3</span>), 
</span></span><span style="display:flex;"><span>  num_points <span style="color:#666">=</span> <span style="color:#00f">c</span>(<span style="color:#666">100</span>, <span style="color:#666">150</span>, <span style="color:#666">50</span>),  <span style="color:#408080;font-style:italic"># number points in each cluster</span>
</span></span><span style="display:flex;"><span>  x1 <span style="color:#666">=</span> <span style="color:#00f">c</span>(<span style="color:#666">5</span>, <span style="color:#666">0</span>, <span style="color:#666">-3</span>),              <span style="color:#408080;font-style:italic"># x1 coordinate of cluster center</span>
</span></span><span style="display:flex;"><span>  x2 <span style="color:#666">=</span> <span style="color:#00f">c</span>(<span style="color:#666">-1</span>, <span style="color:#666">1</span>, <span style="color:#666">-2</span>)              <span style="color:#408080;font-style:italic"># x2 coordinate of cluster center</span>
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>labelled_points <span style="color:#666">&lt;-</span> 
</span></span><span style="display:flex;"><span>  centers <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">mutate</span>(
</span></span><span style="display:flex;"><span>    x1 <span style="color:#666">=</span> <span style="color:#00f">map2</span>(num_points, x1, rnorm),
</span></span><span style="display:flex;"><span>    x2 <span style="color:#666">=</span> <span style="color:#00f">map2</span>(num_points, x2, rnorm)
</span></span><span style="display:flex;"><span>  ) <span style="color:#666">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">select</span>(<span style="color:#666">-</span>num_points) <span style="color:#666">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">unnest</span>(cols <span style="color:#666">=</span> <span style="color:#00f">c</span>(x1, x2))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">ggplot</span>(labelled_points, <span style="color:#00f">aes</span>(x1, x2, color <span style="color:#666">=</span> cluster)) <span style="color:#666">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">geom_point</span>(alpha <span style="color:#666">=</span> <span style="color:#666">0.3</span>)
</span></span></code></pre></div><img src="figs/unnamed-chunk-1-1.svg" width="672" />
<p>This is an ideal case for k-means clustering.</p>
<h2 id="how-does-k-means-work">How does K-means work?</h2>
<p>Rather than using equations, this short animation using the <a href="https://github.com/allisonhorst/stats-illustrations">artwork</a> of Allison Horst explains the clustering process:</p>
<img src="kmeans.gif" style="display: block; margin: auto;" />
<h2 id="clustering-in-r">Clustering in R</h2>
<p>We&rsquo;ll use the built-in <code>kmeans()</code> function, which accepts a data frame with all numeric columns as it&rsquo;s primary argument.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>points <span style="color:#666">&lt;-</span> 
</span></span><span style="display:flex;"><span>  labelled_points <span style="color:#666">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">select</span>(<span style="color:#666">-</span>cluster)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kclust <span style="color:#666">&lt;-</span> <span style="color:#00f">kmeans</span>(points, centers <span style="color:#666">=</span> <span style="color:#666">3</span>)
</span></span><span style="display:flex;"><span>kclust
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; K-means clustering with 3 clusters of sizes 148, 51, 101</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Cluster means:</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;        x1    x2</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 1  0.0885  1.05</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 2 -3.1429 -2.00</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 3  5.0040 -1.05</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Clustering vector:</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;   [1] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  [38] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  [75] 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 3 1 1 1 1 1 1 1 1 1 1 1</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [112] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [149] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [186] 1 1 1 1 1 1 1 1 1 1 1 1 1 3 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [223] 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 1 2 1 1 1 1 1 1 2 2 2 2 2 2 2 2 2</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [260] 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2 2</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [297] 2 2 2 2</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Within cluster sum of squares by cluster:</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [1] 299 109 243</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  (between_SS / total_SS =  82.5 %)</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Available components:</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [1] &#34;cluster&#34;      &#34;centers&#34;      &#34;totss&#34;        &#34;withinss&#34;     &#34;tot.withinss&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [6] &#34;betweenss&#34;    &#34;size&#34;         &#34;iter&#34;         &#34;ifault&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">summary</span>(kclust)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;              Length Class  Mode   </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; cluster      300    -none- numeric</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; centers        6    -none- numeric</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; totss          1    -none- numeric</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; withinss       3    -none- numeric</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; tot.withinss   1    -none- numeric</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; betweenss      1    -none- numeric</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; size           3    -none- numeric</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; iter           1    -none- numeric</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; ifault         1    -none- numeric</span>
</span></span></code></pre></div><p>The output is a list of vectors, where each component has a different length. There&rsquo;s one of length 300, the same as our original data set. There are two elements of length 3 (<code>withinss</code> and <code>tot.withinss</code>) and <code>centers</code> is a matrix with 3 rows. And then there are the elements of length 1: <code>totss</code>, <code>tot.withinss</code>, <code>betweenss</code>, and <code>iter</code>. (The value <code>ifault</code> indicates possible algorithm problems.)</p>
<p>These differing lengths have important meaning when we want to tidy our data set; they signify that each type of component communicates a <em>different kind</em> of information.</p>
<ul>
<li><code>cluster</code> (300 values) contains information about each <em>point</em></li>
<li><code>centers</code>, <code>withinss</code>, and <code>size</code> (3 values) contain information about each <em>cluster</em></li>
<li><code>totss</code>, <code>tot.withinss</code>, <code>betweenss</code>, and <code>iter</code> (1 value) contain information about the <em>full clustering</em></li>
</ul>
<p>Which of these do we want to extract? There is no right answer; each of them may be interesting to an analyst. Because they communicate entirely different information (not to mention there&rsquo;s no straightforward way to combine them), they are extracted by separate functions. <code>augment</code> adds the point classifications to the original data set:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">augment</span>(kclust, points)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 300 × 3</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;       x1     x2 .cluster</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;   </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  1  6.91 -2.74  3       </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  2  6.14 -2.45  3       </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  3  4.24 -0.946 3       </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  4  3.54  0.287 3       </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  5  3.91  0.408 3       </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  6  5.30 -1.58  3       </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  7  5.01 -1.77  3       </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  8  6.16 -1.68  3       </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  9  7.13 -2.17  3       </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 10  5.24 -2.42  3       </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # … with 290 more rows</span>
</span></span></code></pre></div><p>The <code>tidy()</code> function summarizes on a per-cluster level:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">tidy</span>(kclust)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 3 × 5</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;        x1    x2  size withinss cluster</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;int&gt;    &lt;dbl&gt; &lt;fct&gt;  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 1  0.0885  1.05   148     299. 1      </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 2 -3.14   -2.00    51     109. 2      </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 3  5.00   -1.05   101     243. 3</span>
</span></span></code></pre></div><p>And as it always does, the <code>glance()</code> function extracts a single-row summary:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">glance</span>(kclust)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 1 × 4</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;   totss tot.withinss betweenss  iter</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;   &lt;dbl&gt;        &lt;dbl&gt;     &lt;dbl&gt; &lt;int&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 1 3724.         651.     3073.     2</span>
</span></span></code></pre></div><h2 id="exploratory-clustering">Exploratory clustering</h2>
<p>While these summaries are useful, they would not have been too difficult to extract out from the data set yourself. The real power comes from combining these analyses with other tools like <a href="https://dplyr.tidyverse.org/">dplyr</a>.</p>
<p>Let&rsquo;s say we want to explore the effect of different choices of <code>k</code>, from 1 to 9, on this clustering. First cluster the data 9 times, each using a different value of <code>k</code>, then create columns containing the tidied, glanced and augmented data:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>kclusts <span style="color:#666">&lt;-</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">tibble</span>(k <span style="color:#666">=</span> <span style="color:#666">1</span><span style="color:#666">:</span><span style="color:#666">9</span>) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">mutate</span>(
</span></span><span style="display:flex;"><span>    kclust <span style="color:#666">=</span> <span style="color:#00f">map</span>(k, <span style="color:#666">~</span><span style="color:#00f">kmeans</span>(points, .x)),
</span></span><span style="display:flex;"><span>    tidied <span style="color:#666">=</span> <span style="color:#00f">map</span>(kclust, tidy),
</span></span><span style="display:flex;"><span>    glanced <span style="color:#666">=</span> <span style="color:#00f">map</span>(kclust, glance),
</span></span><span style="display:flex;"><span>    augmented <span style="color:#666">=</span> <span style="color:#00f">map</span>(kclust, augment, points)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>kclusts
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 9 × 5</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;       k kclust   tidied           glanced          augmented         </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;   &lt;int&gt; &lt;list&gt;   &lt;list&gt;           &lt;list&gt;           &lt;list&gt;            </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 1     1 &lt;kmeans&gt; &lt;tibble [1 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [300 × 3]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 2     2 &lt;kmeans&gt; &lt;tibble [2 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [300 × 3]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 3     3 &lt;kmeans&gt; &lt;tibble [3 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [300 × 3]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 4     4 &lt;kmeans&gt; &lt;tibble [4 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [300 × 3]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 5     5 &lt;kmeans&gt; &lt;tibble [5 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [300 × 3]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 6     6 &lt;kmeans&gt; &lt;tibble [6 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [300 × 3]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 7     7 &lt;kmeans&gt; &lt;tibble [7 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [300 × 3]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 8     8 &lt;kmeans&gt; &lt;tibble [8 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [300 × 3]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 9     9 &lt;kmeans&gt; &lt;tibble [9 × 5]&gt; &lt;tibble [1 × 4]&gt; &lt;tibble [300 × 3]&gt;</span>
</span></span></code></pre></div><p>We can turn these into three separate data sets each representing a different type of data: using <code>tidy()</code>, using <code>augment()</code>, and using <code>glance()</code>. Each of these goes into a separate data set as they represent different types of data.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>clusters <span style="color:#666">&lt;-</span> 
</span></span><span style="display:flex;"><span>  kclusts <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">unnest</span>(cols <span style="color:#666">=</span> <span style="color:#00f">c</span>(tidied))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>assignments <span style="color:#666">&lt;-</span> 
</span></span><span style="display:flex;"><span>  kclusts <span style="color:#666">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">unnest</span>(cols <span style="color:#666">=</span> <span style="color:#00f">c</span>(augmented))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>clusterings <span style="color:#666">&lt;-</span> 
</span></span><span style="display:flex;"><span>  kclusts <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">unnest</span>(cols <span style="color:#666">=</span> <span style="color:#00f">c</span>(glanced))
</span></span></code></pre></div><p>Now we can plot the original points using the data from <code>augment()</code>, with each point colored according to the predicted cluster.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>p1 <span style="color:#666">&lt;-</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">ggplot</span>(assignments, <span style="color:#00f">aes</span>(x <span style="color:#666">=</span> x1, y <span style="color:#666">=</span> x2)) <span style="color:#666">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">geom_point</span>(<span style="color:#00f">aes</span>(color <span style="color:#666">=</span> .cluster), alpha <span style="color:#666">=</span> <span style="color:#666">0.8</span>) <span style="color:#666">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">facet_wrap</span>(<span style="color:#666">~</span> k)
</span></span><span style="display:flex;"><span>p1
</span></span></code></pre></div><img src="figs/unnamed-chunk-8-1.svg" width="672" />
<p>Already we get a good sense of the proper number of clusters (3), and how the k-means algorithm functions when <code>k</code> is too high or too low. We can then add the centers of the cluster using the data from <code>tidy()</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>p2 <span style="color:#666">&lt;-</span> p1 <span style="color:#666">+</span> <span style="color:#00f">geom_point</span>(data <span style="color:#666">=</span> clusters, size <span style="color:#666">=</span> <span style="color:#666">10</span>, shape <span style="color:#666">=</span> <span style="color:#ba2121">&#34;x&#34;</span>)
</span></span><span style="display:flex;"><span>p2
</span></span></code></pre></div><img src="figs/unnamed-chunk-9-1.svg" width="672" />
<p>The data from <code>glance()</code> fills a different but equally important purpose; it lets us view trends of some summary statistics across values of <code>k</code>. Of particular interest is the total within sum of squares, saved in the <code>tot.withinss</code> column.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">ggplot</span>(clusterings, <span style="color:#00f">aes</span>(k, tot.withinss)) <span style="color:#666">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">geom_line</span>() <span style="color:#666">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">geom_point</span>()
</span></span></code></pre></div><img src="figs/unnamed-chunk-10-1.svg" width="672" />
<p>This represents the variance within the clusters. It decreases as <code>k</code> increases, but notice a bend (or &ldquo;elbow&rdquo;) around <code>k = 3</code>. This bend indicates that additional clusters beyond the third have little value. (See <a href="https://web.stanford.edu/~hastie/Papers/gap.pdf">here</a> for a more mathematically rigorous interpretation and implementation of this method). Thus, all three methods of tidying data provided by broom are useful for summarizing clustering output.</p>
<h2 id="session-information">Session information</h2>
<pre tabindex="0"><code>#&gt; ─ Session info ─────────────────────────────────────────────────────
#&gt;  setting  value
#&gt;  version  R version 4.1.2 (2021-11-01)
#&gt;  os       macOS Monterey 12.3
#&gt;  system   aarch64, darwin20
#&gt;  ui       X11
#&gt;  language (EN)
#&gt;  collate  en_GB.UTF-8
#&gt;  ctype    en_GB.UTF-8
#&gt;  tz       Europe/London
#&gt;  date     2022-04-11
#&gt;  pandoc   2.14.0.3 @ /Applications/RStudio.app/Contents/MacOS/pandoc/ (via rmarkdown)
#&gt; 
#&gt; ─ Packages ─────────────────────────────────────────────────────────
#&gt;  package    * version date (UTC) lib source
#&gt;  broom      * 0.7.12  2022-01-28 [1] CRAN (R 4.1.1)
#&gt;  dials      * 0.1.1   2022-04-06 [1] CRAN (R 4.1.2)
#&gt;  dplyr      * 1.0.8   2022-02-08 [1] CRAN (R 4.1.2)
#&gt;  ggplot2    * 3.3.5   2021-06-25 [1] CRAN (R 4.1.1)
#&gt;  infer      * 1.0.0   2021-08-13 [1] CRAN (R 4.1.1)
#&gt;  parsnip    * 0.2.1   2022-03-17 [1] CRAN (R 4.1.1)
#&gt;  purrr      * 0.3.4   2020-04-17 [1] CRAN (R 4.1.0)
#&gt;  recipes    * 0.2.0   2022-02-18 [1] CRAN (R 4.1.1)
#&gt;  rlang        1.0.2   2022-03-04 [1] CRAN (R 4.1.1)
#&gt;  rsample    * 0.1.1   2021-11-08 [1] CRAN (R 4.1.2)
#&gt;  tibble     * 3.1.6   2021-11-07 [1] CRAN (R 4.1.1)
#&gt;  tidymodels * 0.2.0   2022-03-19 [1] CRAN (R 4.1.1)
#&gt;  tune       * 0.2.0   2022-03-19 [1] CRAN (R 4.1.2)
#&gt;  workflows  * 0.2.6   2022-03-18 [1] CRAN (R 4.1.2)
#&gt;  yardstick  * 0.0.9   2021-11-22 [1] CRAN (R 4.1.1)
#&gt; 
#&gt;  [1] /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/library
#&gt; 
#&gt; ────────────────────────────────────────────────────────────────────
</code></pre>
      </div>


      <div class="article-footer">
      
      <div style="float:left">
      
        <div class='itemTitle' align="left" style='font-size:.8em; line-height:2em'>Previous</div>
        <a href="/learn/statistics/tidy-analysis/">Correlation and regression fundamentals with tidy data principles</a>
      
      </div>
      
      
      <div style="float:right">
      
      <div class='itemTitle' align="right" style='font-size:.8em; line-height:2em'>Next</div>
        <a href="/learn/statistics/bootstrap/">Bootstrap resampling and tidy regression models</a>
      
      </div>
     </div> 

      </div>

      <div class="column25">
        <div class="section hideOnMobile">
          <div class="sectionTitle">Contents</div>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#how-does-k-means-work">How does K-means work?</a></li>
    <li><a href="#clustering-in-r">Clustering in R</a></li>
    <li><a href="#exploratory-clustering">Exploratory clustering</a></li>
    <li><a href="#session-information">Session information</a></li>
  </ul>
</nav>
        </div>
      
        <div class="section">
          <div class="sectionTitle">Resources</div>
          




<div class="event">
  
  <div class="eventTitle">
    <a href="/find/"><i class="fas fa-search fa-xs"></i>&nbsp;&nbsp;Find</a>
  </div>
  <div class="eventDetails">Explore searchable tables of all tidymodels packages and functions.</div>
</div>






<div class="event">
  
  <div class="eventTitle">
    <a href="/books/"><i class="fas fa-book-open fa-xs"></i>&nbsp;&nbsp;Books</a>
  </div>
  <div class="eventDetails">Study up on statistics and modeling with our comprehensive books.</div>
</div>






<div class="event">
  
  <div class="eventTitle">
    <a href="https://www.tidyverse.org/tags/tidymodels/" target="_blank"><i class="fas fa-bullhorn fa-xs"></i>&nbsp;&nbsp;News</a>
  </div>
  <div class="eventDetails">Hear the latest about tidymodels packages at the <a href="https://www.tidyverse.org/tags/tidymodels/">tidyverse blog</a>.</div>
</div>



        </div>
      </div>
      


    </div>
  </div>  
</div> 


        <div id="rStudioFooter" class="band">
          <div class="bandContent">
            <div id="copyright">
              
              
              Proudly supported by <a class="rstudioLogo" href="https://www.rstudio.com/"></a>
              
            </div>
            <div id="logos">
              
              
            </div>
            
            <span class="float-right" aria-hidden="true">
              <a href="#" class="back-to-top">
                <span class="button_icon">
                  <i class="fas fa-chevron-up fa-2x"></i>
                </span>
              </a>
            </span>
            
          </div>
        </div>

      </div>  
    </div>  

    

    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-20375833-29', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>
</html>

</body>
</html>
