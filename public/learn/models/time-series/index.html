<!DOCTYPE html>
<html>
<head>
<!DOCTYPE html>
<html lang="en-us">



<link rel="stylesheet" href="/css/fonts.css">
<link rel="stylesheet" href="/css/main-site.css">
<link rel="stylesheet" href="/css/fa5-all.css">
<style type="text/css">
    body {
	background-color: #ffffff;
	color: #404040
}

/* Links */

a {
  color: #CA225E;
}

a:hover {
  color: #cc3168;
}

/* Landing page content bands */

#homeContent .band.first {
  background-color: #ffffff
}

#homeContent .band.second {
  background-color: #fcfcfc
}

#homeContent .band.third {
  background-color: #ffffff
}

/* Top navigation bar menu */

#rStudioHeader {
  background-color: #ffffff;
  color: black;
}

#rStudioHeader .productName {
  color: #CA225E
}

#rStudioHeader .productName:hover {
  color: #00000075
}

#rStudioHeader #menu .menuItem.a {
  background-color: #75aadb;
  color: black;
}

#rStudioHeader #menu .menuItem:hover {
  background-color: white;
  color: #CA225E;
}

#rStudioHeader #menu .menuItem.current {
  background-color: #fcfcfc;
  color: #CA225E;
  text-decoration: none;
}

/* Footer */

#rStudioFooter.band {
  background-color: #CA225E40;
}

#rStudioFooter .bandContent #copyright {
  color: #CA225E;
}

/* Tables */

table tbody tr:nth-child(even){
  background-color: #fcfcfc;
}

table tbody tr:nth-child(odd){
  background-color: #1a162d10;
}

.latest {
  border-top: .5em solid <no value>;
}
</style>

  <link rel="stylesheet" href="/css/tm.css">




<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="apple-mobile-web-app-capable" content="yes" />

<meta name="og:image" content="https://www.tidymodels.org/images/feature_summary_large_image.jpg" >

  <meta property="twitter:card" content="summary_large_image">

<meta name="twitter:image" content="https://www.tidymodels.org/images/feature_summary_large_image.jpg" ><meta name="generator" content="Hugo 0.96.0" />

<meta property="og:type" content="website"><title>Learn - Modeling time series with tidy resampling</title>
    <meta property="og:title" content="Learn - Modeling time series with tidy resampling">
    
    
    
    
    <meta property="description" content="Calculate performance estimates for time series forecasts using resampling.
">
    <meta property="og:description" content="Calculate performance estimates for time series forecasts using resampling.
">



<link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png" />
<link rel="manifest" href="/images/favicons/site.webmanifest" />
<link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" />
<link rel="shortcut icon" href="/images/favicons/favicon.ico" />
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" href="/images/favicons/browserconfig.xml" >



<script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/js/site.js"></script>


  <script type="text/javascript" src="/js/tm.js"></script>


<link rel="icon" href="/images/favicon.ico" />


<script defer data-domain="tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>



  <body>
    <div id="appTidyverseSite" class="shrinkHeader alwaysShrinkHeader">
      <div id="main">
        
        <div id="rStudioHeader">
          <div class="band">
            <div class="innards bandContent">
              <div>
                <a class="productName" href="/">Tidymodels</a>
                
              </div>
              <div id="menu">
  <div id="menuToggler"></div>
  <div id="menuItems" class="">
    
    
      
      
      
    <a class="menuItem " href="/packages/">Packages</a>
    
      
      
      
    <a class="menuItem " href="/start/">Get Started</a>
    
      
      
      
    <a class="menuItem current" href="/learn/">Learn</a>
    
      
      
      
    <a class="menuItem " href="/help/">Help</a>
    
      
      
      
    <a class="menuItem " href="/contribute/">Contribute</a>
    
      
      
      
    <a class="menuItem " href="/find/"><i class="fas fa-search fa-lg"></i> </a>
    
      
      
      
    <a class="menuItem " href="https://github.com/tidymodels/"><i class="fab fa-github fa-lg"></i></a>
    
  </div>
</div>

            </div>
          </div>
        </div>
</head>
<body>


 




<div class="band padForHeader pushFooter">
  <div class="bandContent">
    <div class="full splitColumns withMobileMargins">
      <div class="column75">
        
        <div class="section">
          <div class="sectionTitle">
            <a href="/learn/">
              <i class="fas fa-chevron-left"></i>&nbsp;Back to Learn
            </a>
          </div>
        </div>

      <h1 class="article-title">Modeling time series with tidy resampling</h1>

      
      <div class="article-header">
        </div>
        

      
      
      
      
        </p>
      
        
      <div class="learning-objective-container">
        <h2 class="learning-objective">Learning objective</h2>
        <p class="single-learning-objective-text">Calculate performance estimates for time series forecasts using resampling.</p>
      </div>
      

      <div class="article-content">
      <h2 id="introduction">Introduction</h2>
<p>To use the code in this article, you will need to install the following packages: forecast, sweep, tidymodels, timetk, and zoo.</p>
<p>&ldquo;<a href="https://www.business-science.io/code-tools/2017/10/25/demo_week_sweep.html">Demo Week: Tidy Forecasting with sweep</a>&rdquo; is an excellent article that uses tidy methods with time series. This article uses their analysis with rsample to find performance estimates for future observations using <a href="https://robjhyndman.com/hyndsight/crossvalidation/">rolling forecast origin resampling</a>.</p>
<h2 id="example-data">Example data</h2>
<p>The data for this article are sales of alcoholic beverages originally from <a href="https://fred.stlouisfed.org/series/S4248SM144NCEN">the Federal Reserve Bank of St. Louis website</a>.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">library</span>(tidymodels)
</span></span><span style="display:flex;"><span><span style="color:#00f">library</span>(modeldata)
</span></span><span style="display:flex;"><span><span style="color:#00f">data</span>(<span style="color:#ba2121">&#34;drinks&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#00f">glimpse</span>(drinks)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Rows: 309</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Columns: 2</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; $ date           &lt;date&gt; 1992-01-01, 1992-02-01, 1992-03-01, 1992-04-01, 1992-0…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; $ S4248SM144NCEN &lt;dbl&gt; 3459, 3458, 4002, 4564, 4221, 4529, 4466, 4137, 4126, 4…</span>
</span></span></code></pre></div><p>Each row represents one month of sales (in millions of US dollars).</p>
<h2 id="time-series-resampling">Time series resampling</h2>
<p>Suppose that we need predictions for one year ahead and our model should use the most recent data from the last 20 years. To set up this resampling scheme:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>roll_rs <span style="color:#666">&lt;-</span> <span style="color:#00f">rolling_origin</span>(
</span></span><span style="display:flex;"><span>  drinks, 
</span></span><span style="display:flex;"><span>  initial <span style="color:#666">=</span> <span style="color:#666">12</span> <span style="color:#666">*</span> <span style="color:#666">20</span>, 
</span></span><span style="display:flex;"><span>  assess <span style="color:#666">=</span> <span style="color:#666">12</span>,
</span></span><span style="display:flex;"><span>  cumulative <span style="color:#666">=</span> <span style="color:#008000;font-weight:bold">FALSE</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">nrow</span>(roll_rs)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [1] 58</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>roll_rs
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # Rolling origin forecast resampling </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 58 × 2</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    splits           id     </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    &lt;list&gt;           &lt;chr&gt;  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  1 &lt;split [240/12]&gt; Slice01</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  2 &lt;split [240/12]&gt; Slice02</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  3 &lt;split [240/12]&gt; Slice03</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  4 &lt;split [240/12]&gt; Slice04</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  5 &lt;split [240/12]&gt; Slice05</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  6 &lt;split [240/12]&gt; Slice06</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  7 &lt;split [240/12]&gt; Slice07</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  8 &lt;split [240/12]&gt; Slice08</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  9 &lt;split [240/12]&gt; Slice09</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 10 &lt;split [240/12]&gt; Slice10</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # … with 48 more rows</span>
</span></span></code></pre></div><p>Each <code>split</code> element contains the information about that resample:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>roll_rs<span style="color:#666">$</span>splits[[1]]
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; &lt;Analysis/Assess/Total&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; &lt;240/12/309&gt;</span>
</span></span></code></pre></div><p>For plotting, let&rsquo;s index each split by the first day of the assessment set:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>get_date <span style="color:#666">&lt;-</span> <span style="color:#00f">function</span>(x) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">min</span>(<span style="color:#00f">assessment</span>(x)<span style="color:#666">$</span>date)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>start_date <span style="color:#666">&lt;-</span> <span style="color:#00f">map</span>(roll_rs<span style="color:#666">$</span>splits, get_date)
</span></span><span style="display:flex;"><span>roll_rs<span style="color:#666">$</span>start_date <span style="color:#666">&lt;-</span> <span style="color:#00f">do.call</span>(<span style="color:#ba2121">&#34;c&#34;</span>, start_date)
</span></span><span style="display:flex;"><span><span style="color:#00f">head</span>(roll_rs<span style="color:#666">$</span>start_date)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [1] &#34;2012-01-01&#34; &#34;2012-02-01&#34; &#34;2012-03-01&#34; &#34;2012-04-01&#34; &#34;2012-05-01&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [6] &#34;2012-06-01&#34;</span>
</span></span></code></pre></div><p>This resampling scheme has 58 splits of the data so that there will be 58 ARIMA models that are fit. To create the models, we use the <code>auto.arima()</code> function from the forecast package. The rsample functions <code>analysis()</code> and <code>assessment()</code> return a data frame, so another step converts the data to a <code>ts</code> object called <code>mod_dat</code> using a function in the timetk package.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">library</span>(forecast)  <span style="color:#408080;font-style:italic"># for `auto.arima`</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">library</span>(timetk)    <span style="color:#408080;font-style:italic"># for `tk_ts`</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">library</span>(zoo)       <span style="color:#408080;font-style:italic"># for `as.yearmon`</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>fit_model <span style="color:#666">&lt;-</span> <span style="color:#00f">function</span>(x, <span style="color:#008000;font-weight:bold">...</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic"># suggested by Matt Dancho:</span>
</span></span><span style="display:flex;"><span>  x <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00f">analysis</span>() <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#408080;font-style:italic"># Since the first day changes over resamples, adjust it</span>
</span></span><span style="display:flex;"><span>    <span style="color:#408080;font-style:italic"># based on the first date value in the data frame </span>
</span></span><span style="display:flex;"><span>    <span style="color:#00f">tk_ts</span>(start <span style="color:#666">=</span> .$date[[1]] <span style="color:#666">%&gt;%</span> <span style="color:#00f">as.yearmon</span>(), 
</span></span><span style="display:flex;"><span>          frequency <span style="color:#666">=</span> <span style="color:#666">12</span>, 
</span></span><span style="display:flex;"><span>          silent <span style="color:#666">=</span> <span style="color:#008000;font-weight:bold">TRUE</span>) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00f">auto.arima</span>(<span style="color:#008000;font-weight:bold">...</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Save each model in a new column:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>roll_rs<span style="color:#666">$</span>arima <span style="color:#666">&lt;-</span> <span style="color:#00f">map</span>(roll_rs<span style="color:#666">$</span>splits, fit_model)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"># For example:</span>
</span></span><span style="display:flex;"><span>roll_rs<span style="color:#666">$</span>arima[[1]]
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Series: . </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; ARIMA(4,1,1)(0,1,2)[12] </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Coefficients:</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;          ar1     ar2    ar3     ar4     ma1    sma1    sma2</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;       -0.185  -0.024  0.358  -0.152  -0.831  -0.193  -0.324</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; s.e.   0.147   0.166  0.144   0.081   0.138   0.067   0.064</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; sigma^2 = 72198:  log likelihood = -1591</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; AIC=3198   AICc=3199   BIC=3226</span>
</span></span></code></pre></div><p>(There are some warnings produced by these regarding extra columns in the data that can be ignored.)</p>
<h2 id="model-performance">Model performance</h2>
<p>Using the model fits, let&rsquo;s measure performance in two ways:</p>
<ul>
<li><em>Interpolation</em> error will measure how well the model fits to the data that were used to create the model. This is most likely optimistic since no holdout method is used.</li>
<li><em>Extrapolation</em> or <em>forecast</em> error evaluates the performance of the model on the data from the following year (that were not used in the model fit).</li>
</ul>
<p>In each case, the mean absolute percent error (MAPE) is the statistic used to characterize the model fits. The interpolation error can be computed from the <code>Arima</code> object. To make things easy, let&rsquo;s use the sweep package&rsquo;s <code>sw_glance()</code> function:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">library</span>(sweep)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>roll_rs<span style="color:#666">$</span>interpolation <span style="color:#666">&lt;-</span> <span style="color:#00f">map_dbl</span>(
</span></span><span style="display:flex;"><span>  roll_rs<span style="color:#666">$</span>arima,
</span></span><span style="display:flex;"><span>  <span style="color:#00f">function</span>(x) 
</span></span><span style="display:flex;"><span>    <span style="color:#00f">sw_glance</span>(x)[[<span style="color:#ba2121">&#34;MAPE&#34;</span>]]
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">summary</span>(roll_rs<span style="color:#666">$</span>interpolation)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    2.84    2.92    2.95    2.95    2.97    3.13</span>
</span></span></code></pre></div><p>For the extrapolation error, the model and split objects are required. Using these:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>get_extrap <span style="color:#666">&lt;-</span> <span style="color:#00f">function</span>(split, mod) {
</span></span><span style="display:flex;"><span>  n <span style="color:#666">&lt;-</span> <span style="color:#00f">nrow</span>(<span style="color:#00f">assessment</span>(split))
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic"># Get assessment data</span>
</span></span><span style="display:flex;"><span>  pred_dat <span style="color:#666">&lt;-</span> <span style="color:#00f">assessment</span>(split) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>    <span style="color:#00f">mutate</span>(
</span></span><span style="display:flex;"><span>      pred <span style="color:#666">=</span> <span style="color:#00f">as.vector</span>(<span style="color:#00f">forecast</span>(mod, h <span style="color:#666">=</span> n)<span style="color:#666">$</span>mean),
</span></span><span style="display:flex;"><span>      pct_error <span style="color:#666">=</span> ( S4248SM144NCEN <span style="color:#666">-</span> pred ) <span style="color:#666">/</span> S4248SM144NCEN <span style="color:#666">*</span> <span style="color:#666">100</span>
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  <span style="color:#00f">mean</span>(<span style="color:#00f">abs</span>(pred_dat<span style="color:#666">$</span>pct_error))
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>roll_rs<span style="color:#666">$</span>extrapolation <span style="color:#666">&lt;-</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">map2_dbl</span>(roll_rs<span style="color:#666">$</span>splits, roll_rs<span style="color:#666">$</span>arima, get_extrap)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">summary</span>(roll_rs<span style="color:#666">$</span>extrapolation)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    2.37    3.23    3.63    3.65    4.11    5.45</span>
</span></span></code></pre></div><p>What do these error estimates look like over time?</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>roll_rs <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">select</span>(interpolation, extrapolation, start_date) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">pivot_longer</span>(cols <span style="color:#666">=</span> <span style="color:#00f">matches</span>(<span style="color:#ba2121">&#34;ation&#34;</span>), names_to <span style="color:#666">=</span> <span style="color:#ba2121">&#34;error&#34;</span>, values_to <span style="color:#666">=</span> <span style="color:#ba2121">&#34;MAPE&#34;</span>) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">ggplot</span>(<span style="color:#00f">aes</span>(x <span style="color:#666">=</span> start_date, y <span style="color:#666">=</span> MAPE, col <span style="color:#666">=</span> error)) <span style="color:#666">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">geom_point</span>() <span style="color:#666">+</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">geom_line</span>()
</span></span></code></pre></div><img src="figs/plot-1.svg" width="672" />
<p>It is likely that the interpolation error is an underestimate to some degree, as mentioned above.</p>
<p>It is also worth noting that <code>rolling_origin()</code> can be used over calendar periods, rather than just over a fixed window size. This is especially useful for irregular series where a fixed window size might not make sense because of missing data points, or because of calendar features like different months having a different number of days.</p>
<p>The example below demonstrates this idea by splitting <code>drinks</code> into a nested set of 26 years, and rolling over years rather than months. Note that the end result accomplishes a different task than the original example; in this new case, each slice moves forward an entire year, rather than just one month.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#408080;font-style:italic"># The idea is to nest by the period to roll over,</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"># which in this case is the year.</span>
</span></span><span style="display:flex;"><span>roll_rs_annual <span style="color:#666">&lt;-</span> drinks <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">mutate</span>(year <span style="color:#666">=</span> <span style="color:#00f">as.POSIXlt</span>(date)<span style="color:#666">$</span>year <span style="color:#666">+</span> <span style="color:#666">1900</span>) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">nest</span>(data <span style="color:#666">=</span> <span style="color:#00f">c</span>(date, S4248SM144NCEN)) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">rolling_origin</span>(
</span></span><span style="display:flex;"><span>    initial <span style="color:#666">=</span> <span style="color:#666">20</span>, 
</span></span><span style="display:flex;"><span>    assess <span style="color:#666">=</span> <span style="color:#666">1</span>, 
</span></span><span style="display:flex;"><span>    cumulative <span style="color:#666">=</span> <span style="color:#008000;font-weight:bold">FALSE</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">analysis</span>(roll_rs_annual<span style="color:#666">$</span>splits[[1]])
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 20 × 2</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;     year data             </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    &lt;dbl&gt; &lt;list&gt;           </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  1  1992 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  2  1993 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  3  1994 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  4  1995 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  5  1996 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  6  1997 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  7  1998 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  8  1999 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  9  2000 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 10  2001 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 11  2002 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 12  2003 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 13  2004 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 14  2005 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 15  2006 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 16  2007 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 17  2008 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 18  2009 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 19  2010 &lt;tibble [12 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 20  2011 &lt;tibble [12 × 2]&gt;</span>
</span></span></code></pre></div><p>The workflow to access these calendar slices is to use <code>bind_rows()</code> to join
each analysis set together.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">mutate</span>(
</span></span><span style="display:flex;"><span>  roll_rs_annual,
</span></span><span style="display:flex;"><span>  extracted_slice <span style="color:#666">=</span> <span style="color:#00f">map</span>(splits, <span style="color:#666">~</span> <span style="color:#00f">bind_rows</span>(<span style="color:#00f">analysis</span>(.x)<span style="color:#666">$</span>data))
</span></span><span style="display:flex;"><span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # Rolling origin forecast resampling </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 6 × 3</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;   splits         id     extracted_slice   </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;   &lt;list&gt;         &lt;chr&gt;  &lt;list&gt;            </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 1 &lt;split [20/1]&gt; Slice1 &lt;tibble [240 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 2 &lt;split [20/1]&gt; Slice2 &lt;tibble [240 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 3 &lt;split [20/1]&gt; Slice3 &lt;tibble [240 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 4 &lt;split [20/1]&gt; Slice4 &lt;tibble [240 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 5 &lt;split [20/1]&gt; Slice5 &lt;tibble [240 × 2]&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 6 &lt;split [20/1]&gt; Slice6 &lt;tibble [240 × 2]&gt;</span>
</span></span></code></pre></div><h2 id="session-information">Session information</h2>
<pre tabindex="0"><code>#&gt; ─ Session info ─────────────────────────────────────────────────────
#&gt;  setting  value
#&gt;  version  R version 4.1.2 (2021-11-01)
#&gt;  os       macOS Monterey 12.3
#&gt;  system   aarch64, darwin20
#&gt;  ui       X11
#&gt;  language (EN)
#&gt;  collate  en_GB.UTF-8
#&gt;  ctype    en_GB.UTF-8
#&gt;  tz       Europe/London
#&gt;  date     2022-04-11
#&gt;  pandoc   2.14.0.3 @ /Applications/RStudio.app/Contents/MacOS/pandoc/ (via rmarkdown)
#&gt; 
#&gt; ─ Packages ─────────────────────────────────────────────────────────
#&gt;  package    * version date (UTC) lib source
#&gt;  broom      * 0.7.12  2022-01-28 [1] CRAN (R 4.1.1)
#&gt;  dials      * 0.1.1   2022-04-06 [1] CRAN (R 4.1.2)
#&gt;  dplyr      * 1.0.8   2022-02-08 [1] CRAN (R 4.1.2)
#&gt;  forecast   * 8.16    2022-01-10 [1] CRAN (R 4.1.2)
#&gt;  ggplot2    * 3.3.5   2021-06-25 [1] CRAN (R 4.1.1)
#&gt;  infer      * 1.0.0   2021-08-13 [1] CRAN (R 4.1.1)
#&gt;  parsnip    * 0.2.1   2022-03-17 [1] CRAN (R 4.1.1)
#&gt;  purrr      * 0.3.4   2020-04-17 [1] CRAN (R 4.1.0)
#&gt;  recipes    * 0.2.0   2022-02-18 [1] CRAN (R 4.1.1)
#&gt;  rlang        1.0.2   2022-03-04 [1] CRAN (R 4.1.1)
#&gt;  rsample    * 0.1.1   2021-11-08 [1] CRAN (R 4.1.2)
#&gt;  sweep      * 0.2.3   2020-07-10 [1] CRAN (R 4.1.2)
#&gt;  tibble     * 3.1.6   2021-11-07 [1] CRAN (R 4.1.1)
#&gt;  tidymodels * 0.2.0   2022-03-19 [1] CRAN (R 4.1.1)
#&gt;  timetk     * 2.8.0   2022-04-07 [1] CRAN (R 4.1.2)
#&gt;  tune       * 0.2.0   2022-03-19 [1] CRAN (R 4.1.2)
#&gt;  workflows  * 0.2.6   2022-03-18 [1] CRAN (R 4.1.2)
#&gt;  yardstick  * 0.0.9   2021-11-22 [1] CRAN (R 4.1.1)
#&gt;  zoo        * 1.8-9   2021-03-09 [1] CRAN (R 4.1.2)
#&gt; 
#&gt;  [1] /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/library
#&gt; 
#&gt; ────────────────────────────────────────────────────────────────────
</code></pre>
      </div>


      <div class="article-footer">
      
      <div style="float:left">
      
        <div class='itemTitle' align="left" style='font-size:.8em; line-height:2em'>Previous</div>
        <a href="/learn/models/sub-sampling/">Subsampling for class imbalances</a>
      
      </div>
      
      
      <div style="float:right">
      
      <div class='itemTitle' align="right" style='font-size:.8em; line-height:2em'>Next</div>
        <a href="/learn/models/coefficients/">Working with model coefficients</a>
      
      </div>
     </div> 

      </div>

      <div class="column25">
        <div class="section hideOnMobile">
          <div class="sectionTitle">Contents</div>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#example-data">Example data</a></li>
    <li><a href="#time-series-resampling">Time series resampling</a></li>
    <li><a href="#model-performance">Model performance</a></li>
    <li><a href="#session-information">Session information</a></li>
  </ul>
</nav>
        </div>
      
        <div class="section">
          <div class="sectionTitle">Resources</div>
          




<div class="event">
  
  <div class="eventTitle">
    <a href="/find/"><i class="fas fa-search fa-xs"></i>&nbsp;&nbsp;Find</a>
  </div>
  <div class="eventDetails">Explore searchable tables of all tidymodels packages and functions.</div>
</div>






<div class="event">
  
  <div class="eventTitle">
    <a href="/books/"><i class="fas fa-book-open fa-xs"></i>&nbsp;&nbsp;Books</a>
  </div>
  <div class="eventDetails">Study up on statistics and modeling with our comprehensive books.</div>
</div>






<div class="event">
  
  <div class="eventTitle">
    <a href="https://www.tidyverse.org/tags/tidymodels/" target="_blank"><i class="fas fa-bullhorn fa-xs"></i>&nbsp;&nbsp;News</a>
  </div>
  <div class="eventDetails">Hear the latest about tidymodels packages at the <a href="https://www.tidyverse.org/tags/tidymodels/">tidyverse blog</a>.</div>
</div>



        </div>
      </div>
      


    </div>
  </div>  
</div> 


        <div id="rStudioFooter" class="band">
          <div class="bandContent">
            <div id="copyright">
              
              
              Proudly supported by <a class="rstudioLogo" href="https://www.rstudio.com/"></a>
              
            </div>
            <div id="logos">
              
              
            </div>
            
            <span class="float-right" aria-hidden="true">
              <a href="#" class="back-to-top">
                <span class="button_icon">
                  <i class="fas fa-chevron-up fa-2x"></i>
                </span>
              </a>
            </span>
            
          </div>
        </div>

      </div>  
    </div>  

    

    
<script src="/js/math-code.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-20375833-29', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>
</html>

</body>
</html>
