<!DOCTYPE html>
<html>
<head>
<!DOCTYPE html>
<html lang="en-us">



<link rel="stylesheet" href="/css/fonts.css">
<link rel="stylesheet" href="/css/main-site.css">
<link rel="stylesheet" href="/css/fa5-all.css">
<style type="text/css">
    body {
	background-color: #ffffff;
	color: #404040
}

/* Links */

a {
  color: #CA225E;
}

a:hover {
  color: #cc3168;
}

/* Landing page content bands */

#homeContent .band.first {
  background-color: #ffffff
}

#homeContent .band.second {
  background-color: #fcfcfc
}

#homeContent .band.third {
  background-color: #ffffff
}

/* Top navigation bar menu */

#rStudioHeader {
  background-color: #ffffff;
  color: black;
}

#rStudioHeader .productName {
  color: #CA225E
}

#rStudioHeader .productName:hover {
  color: #00000075
}

#rStudioHeader #menu .menuItem.a {
  background-color: #75aadb;
  color: black;
}

#rStudioHeader #menu .menuItem:hover {
  background-color: white;
  color: #CA225E;
}

#rStudioHeader #menu .menuItem.current {
  background-color: #fcfcfc;
  color: #CA225E;
  text-decoration: none;
}

/* Footer */

#rStudioFooter.band {
  background-color: #CA225E40;
}

#rStudioFooter .bandContent #copyright {
  color: #CA225E;
}

/* Tables */

table tbody tr:nth-child(even){
  background-color: #fcfcfc;
}

table tbody tr:nth-child(odd){
  background-color: #1a162d10;
}

.latest {
  border-top: .5em solid <no value>;
}
</style>

  <link rel="stylesheet" href="/css/tm.css">




<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="apple-mobile-web-app-capable" content="yes" />

<meta name="og:image" content="https://www.tidymodels.org/images/feature_summary_large_image.jpg" >

  <meta property="twitter:card" content="summary_large_image">

<meta name="twitter:image" content="https://www.tidymodels.org/images/feature_summary_large_image.jpg" ><meta name="generator" content="Hugo 0.96.0" />

<meta property="og:type" content="website"><title>Learn - How to create a tuning parameter function</title>
    <meta property="og:title" content="Learn - How to create a tuning parameter function">
    
    
    
    
    <meta property="description" content="Build functions to use in tuning both quantitative and qualitative parameters.
">
    <meta property="og:description" content="Build functions to use in tuning both quantitative and qualitative parameters.
">



<link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png" />
<link rel="manifest" href="/images/favicons/site.webmanifest" />
<link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" />
<link rel="shortcut icon" href="/images/favicons/favicon.ico" />
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" href="/images/favicons/browserconfig.xml" >



<script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/js/site.js"></script>


  <script type="text/javascript" src="/js/tm.js"></script>


<link rel="icon" href="/images/favicon.ico" />


<script defer data-domain="tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>



  <body>
    <div id="appTidyverseSite" class="shrinkHeader alwaysShrinkHeader">
      <div id="main">
        
        <div id="rStudioHeader">
          <div class="band">
            <div class="innards bandContent">
              <div>
                <a class="productName" href="/">Tidymodels</a>
                
              </div>
              <div id="menu">
  <div id="menuToggler"></div>
  <div id="menuItems" class="">
    
    
      
      
      
    <a class="menuItem " href="/packages/">Packages</a>
    
      
      
      
    <a class="menuItem " href="/start/">Get Started</a>
    
      
      
      
    <a class="menuItem current" href="/learn/">Learn</a>
    
      
      
      
    <a class="menuItem " href="/help/">Help</a>
    
      
      
      
    <a class="menuItem " href="/contribute/">Contribute</a>
    
      
      
      
    <a class="menuItem " href="/find/"><i class="fas fa-search fa-lg"></i> </a>
    
      
      
      
    <a class="menuItem " href="https://github.com/tidymodels/"><i class="fab fa-github fa-lg"></i></a>
    
  </div>
</div>

            </div>
          </div>
        </div>
</head>
<body>


 




<div class="band padForHeader pushFooter">
  <div class="bandContent">
    <div class="full splitColumns withMobileMargins">
      <div class="column75">
        
        <div class="section">
          <div class="sectionTitle">
            <a href="/learn/">
              <i class="fas fa-chevron-left"></i>&nbsp;Back to Learn
            </a>
          </div>
        </div>

      <h1 class="article-title">How to create a tuning parameter function</h1>

      
      <div class="article-header">
        </div>
        

      
      
      
      
        </p>
      
        
      <div class="learning-objective-container">
        <h2 class="learning-objective">Learning objective</h2>
        <p class="single-learning-objective-text">Build functions to use in tuning both quantitative and qualitative parameters.</p>
      </div>
      

      <div class="article-content">
      <h2 id="introduction">Introduction</h2>
<p>To use the code in this article, you will need to install the following packages: dials and scales.</p>
<p>Some models and recipe steps contain parameters that dials does not know about. You can construct new quantitative and qualitative parameters using <code>new_quant_param()</code> or <code>new_qual_param()</code>, respectively.  This article is a guide to creating new parameters.</p>
<h2 id="quantitative-parameters">Quantitative parameters</h2>
<p>As an example, let&rsquo;s consider the multivariate adaptive regression spline (<a href="https://en.wikipedia.org/wiki/Multivariate_adaptive_regression_spline">MARS</a>) model, which creates nonlinear features from predictors and adds them to a linear regression models. The earth package is an excellent implementation of this method.</p>
<p>MARS creates an initial set of features and then prunes them back to an appropriate size. This can be done automatically by <code>earth::earth()</code> or the number of final terms can be set by the user. The parsnip function <code>mars()</code> has a parameter called <code>num_terms</code> that defines this.</p>
<p>What if we want to create a parameter for the number of <em>initial terms</em> included in the model. There is no argument in <code>parsnip::mars()</code> for this but we will make one now. The argument name in <code>earth::earth()</code> is <code>nk</code>, which is not very descriptive. Our parameter will be called <code>num_initial_terms</code>.</p>
<p>We use the <code>new_quant_param()</code> function since this is a numeric parameter. The main two arguments to a numeric parameter function are <code>range</code> and <code>trans</code>.</p>
<p>The <code>range</code> specifies the possible values of the parameter. For our example, a minimal value might be one or two. What is the upper limit? The default in the earth package is</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">min</span>(<span style="color:#666">200</span>, <span style="color:#00f">max</span>(<span style="color:#666">20</span>, <span style="color:#666">2</span> <span style="color:#666">*</span> <span style="color:#00f">ncol</span>(x))) <span style="color:#666">+</span> <span style="color:#666">1</span>
</span></span></code></pre></div><p>where <code>x</code> is the predictor matrix. We often put in values that are either sensible defaults or are minimal enough to work for the majority of data sets. For now, let&rsquo;s specify an upper limit of 10 but this will be discussed more in the next section.</p>
<p>The other argument is <code>trans</code>, which represents a transformation that should be applied to the parameter values when working with them. For example, many regularization methods have a <code>penalty</code> parameter that tends to range between zero and some upper bound (let&rsquo;s say 1). The effect of going from a penalty value of 0.01 to 0.1 is much more impactful than going from 0.9 to 1.0. In such a case, it might make sense to work with this parameter in transformed units (such as the log, in this example). If new parameter values are generated at random, it helps if they are uniformly simulated in the transformed units and then converted back to the original units.</p>
<p>The <code>trans</code> parameter accepts a transformation object from the scales package. For example:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">library</span>(scales)
</span></span><span style="display:flex;"><span><span style="color:#00f">lsf.str</span>(<span style="color:#ba2121">&#34;package:scales&#34;</span>, pattern <span style="color:#666">=</span> <span style="color:#ba2121">&#34;_trans$&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; asn_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; atanh_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; boxcox_trans : function (p, offset = 0)  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; date_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; exp_trans : function (base = exp(1))  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; hms_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; identity_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; log_trans : function (base = exp(1))  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; log10_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; log1p_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; log2_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; logit_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; modulus_trans : function (p, offset = 1)  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; probability_trans : function (distribution, ...)  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; probit_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; pseudo_log_trans : function (sigma = 1, base = exp(1))  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; reciprocal_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; reverse_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; sqrt_trans : function ()  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; time_trans : function (tz = NULL)  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; yj_trans : function (p)</span>
</span></span><span style="display:flex;"><span>scales<span style="color:#666">::</span><span style="color:#00f">log10_trans</span>()
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Transformer:  log-10</span>
</span></span></code></pre></div><p>A value of <code>NULL</code> means that no transformation should be used.</p>
<p>A quantitative parameter function should have these two arguments and, in the function body, a call <code>new_quant_param()</code>. There are a few arguments to this function:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">library</span>(tidymodels)
</span></span><span style="display:flex;"><span><span style="color:#00f">args</span>(new_quant_param)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; function (type = c(&#34;double&#34;, &#34;integer&#34;), range, inclusive, default = unknown(), </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;     trans = NULL, values = NULL, label = NULL, finalize = NULL) </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; NULL</span>
</span></span></code></pre></div><ul>
<li>
<p>Possible types are double precision and integers. The value of <code>type</code> should agree with the values of <code>range</code> in the function definition.</p>
</li>
<li>
<p>It&rsquo;s OK for our tuning to include the minimum or maximum, so we&rsquo;ll use <code>c(TRUE, TRUE)</code> for <code>inclusive</code>.  If the value cannot include one end of the range, set one or both of these values to <code>FALSE</code>.</p>
</li>
<li>
<p>The <code>label</code> should be a named character string where the name is the parameter name and the value represents what will be printed automatically.</p>
</li>
<li>
<p><code>finalize</code> is an argument that can set parts of the range. This is discussed more below.</p>
</li>
</ul>
<p>Here&rsquo;s an example of a basic quantitative parameter object:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>num_initial_terms <span style="color:#666">&lt;-</span> <span style="color:#00f">function</span>(range <span style="color:#666">=</span> <span style="color:#00f">c</span>(<span style="color:#666">1L</span>, <span style="color:#666">10L</span>), trans <span style="color:#666">=</span> <span style="color:#008000;font-weight:bold">NULL</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">new_quant_param</span>(
</span></span><span style="display:flex;"><span>    type <span style="color:#666">=</span> <span style="color:#ba2121">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>    range <span style="color:#666">=</span> range,
</span></span><span style="display:flex;"><span>    inclusive <span style="color:#666">=</span> <span style="color:#00f">c</span>(<span style="color:#008000;font-weight:bold">TRUE</span>, <span style="color:#008000;font-weight:bold">TRUE</span>),
</span></span><span style="display:flex;"><span>    trans <span style="color:#666">=</span> trans,
</span></span><span style="display:flex;"><span>    label <span style="color:#666">=</span> <span style="color:#00f">c</span>(num_initial_terms <span style="color:#666">=</span> <span style="color:#ba2121">&#34;# Initial MARS Terms&#34;</span>),
</span></span><span style="display:flex;"><span>    finalize <span style="color:#666">=</span> <span style="color:#008000;font-weight:bold">NULL</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">num_initial_terms</span>()
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # Initial MARS Terms (quantitative)</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Range: [1, 10]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"># Sample from the parameter:</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">set.seed</span>(<span style="color:#666">4832856</span>)
</span></span><span style="display:flex;"><span><span style="color:#00f">num_initial_terms</span>() <span style="color:#666">%&gt;%</span> <span style="color:#00f">value_sample</span>(<span style="color:#666">5</span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [1]  6  4  9 10  4</span>
</span></span></code></pre></div><h3 id="finalizing-parameters">Finalizing parameters</h3>
<p>It might be the case that the range of the parameter is unknown. For example, parameters that are related to the number of columns in a data set cannot be exactly specified in the absence of data. In those cases, a placeholder of <code>unknown()</code> can be added. This will force the user to &ldquo;finalize&rdquo; the parameter object for their particular data set. Let&rsquo;s redefine our function with an <code>unknown()</code> value:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>num_initial_terms <span style="color:#666">&lt;-</span> <span style="color:#00f">function</span>(range <span style="color:#666">=</span> <span style="color:#00f">c</span>(<span style="color:#666">1L</span>, <span style="color:#00f">unknown</span>()), trans <span style="color:#666">=</span> <span style="color:#008000;font-weight:bold">NULL</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">new_quant_param</span>(
</span></span><span style="display:flex;"><span>    type <span style="color:#666">=</span> <span style="color:#ba2121">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>    range <span style="color:#666">=</span> range,
</span></span><span style="display:flex;"><span>    inclusive <span style="color:#666">=</span> <span style="color:#00f">c</span>(<span style="color:#008000;font-weight:bold">TRUE</span>, <span style="color:#008000;font-weight:bold">TRUE</span>),
</span></span><span style="display:flex;"><span>    trans <span style="color:#666">=</span> trans,
</span></span><span style="display:flex;"><span>    label <span style="color:#666">=</span> <span style="color:#00f">c</span>(num_initial_terms <span style="color:#666">=</span> <span style="color:#ba2121">&#34;# Initial MARS Terms&#34;</span>),
</span></span><span style="display:flex;"><span>    finalize <span style="color:#666">=</span> <span style="color:#008000;font-weight:bold">NULL</span>
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#00f">num_initial_terms</span>()
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # Initial MARS Terms (quantitative)</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Range: [1, ?]</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"># Can we sample? </span>
</span></span><span style="display:flex;"><span><span style="color:#00f">num_initial_terms</span>() <span style="color:#666">%&gt;%</span> <span style="color:#00f">value_sample</span>(<span style="color:#666">5</span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Error in `range_validate()`:</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; ! Cannot validate ranges when they contains 1+ unknown values.</span>
</span></span></code></pre></div><p>The <code>finalize</code> argument of <code>num_initial_terms()</code> can take a function that uses data to set the range. For example, the package already includes a few functions for finalization:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">lsf.str</span>(<span style="color:#ba2121">&#34;package:dials&#34;</span>, pattern <span style="color:#666">=</span> <span style="color:#ba2121">&#34;^get_&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; get_batch_sizes : function (object, x, frac = c(1/10, 1/3), ...)  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; get_log_p : function (object, x, ...)  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; get_n : function (object, x, log_vals = FALSE, ...)  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; get_n_frac : function (object, x, log_vals = FALSE, frac = 1/3, ...)  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; get_n_frac_range : function (object, x, log_vals = FALSE, frac = c(1/10, 5/10), ...)  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; get_p : function (object, x, log_vals = FALSE, ...)  </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; get_rbf_range : function (object, x, seed = sample.int(10^5, 1), ...)</span>
</span></span></code></pre></div><p>These functions generally take a data frame of predictors (in an argument called <code>x</code>) and add the range of the parameter object. Using the formula in the earth package, we might use:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>get_initial_mars_terms <span style="color:#666">&lt;-</span> <span style="color:#00f">function</span>(object, x) {
</span></span><span style="display:flex;"><span>  upper_bound <span style="color:#666">&lt;-</span> <span style="color:#00f">min</span>(<span style="color:#666">200</span>, <span style="color:#00f">max</span>(<span style="color:#666">20</span>, <span style="color:#666">2</span> <span style="color:#666">*</span> <span style="color:#00f">ncol</span>(x))) <span style="color:#666">+</span> <span style="color:#666">1</span>
</span></span><span style="display:flex;"><span>  upper_bound <span style="color:#666">&lt;-</span> <span style="color:#00f">as.integer</span>(upper_bound)
</span></span><span style="display:flex;"><span>  bounds <span style="color:#666">&lt;-</span> <span style="color:#00f">range_get</span>(object)
</span></span><span style="display:flex;"><span>  bounds<span style="color:#666">$</span>upper <span style="color:#666">&lt;-</span> upper_bound
</span></span><span style="display:flex;"><span>  <span style="color:#00f">range_set</span>(object, bounds)
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"># Use the mtcars are the finalize the upper bound: </span>
</span></span><span style="display:flex;"><span><span style="color:#00f">num_initial_terms</span>() <span style="color:#666">%&gt;%</span> <span style="color:#00f">get_initial_mars_terms</span>(x <span style="color:#666">=</span> mtcars[, <span style="color:#666">-1</span>])
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # Initial MARS Terms (quantitative)</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Range: [1, 21]</span>
</span></span></code></pre></div><p>Once we add this function to the object, the general <code>finalize()</code> method can be used:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>num_initial_terms <span style="color:#666">&lt;-</span> <span style="color:#00f">function</span>(range <span style="color:#666">=</span> <span style="color:#00f">c</span>(<span style="color:#666">1L</span>, <span style="color:#00f">unknown</span>()), trans <span style="color:#666">=</span> <span style="color:#008000;font-weight:bold">NULL</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">new_quant_param</span>(
</span></span><span style="display:flex;"><span>    type <span style="color:#666">=</span> <span style="color:#ba2121">&#34;integer&#34;</span>,
</span></span><span style="display:flex;"><span>    range <span style="color:#666">=</span> range,
</span></span><span style="display:flex;"><span>    inclusive <span style="color:#666">=</span> <span style="color:#00f">c</span>(<span style="color:#008000;font-weight:bold">TRUE</span>, <span style="color:#008000;font-weight:bold">TRUE</span>),
</span></span><span style="display:flex;"><span>    trans <span style="color:#666">=</span> trans,
</span></span><span style="display:flex;"><span>    label <span style="color:#666">=</span> <span style="color:#00f">c</span>(num_initial_terms <span style="color:#666">=</span> <span style="color:#ba2121">&#34;# Initial MARS Terms&#34;</span>),
</span></span><span style="display:flex;"><span>    finalize <span style="color:#666">=</span> get_initial_mars_terms
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">num_initial_terms</span>() <span style="color:#666">%&gt;%</span> <span style="color:#00f">finalize</span>(x <span style="color:#666">=</span> mtcars[, <span style="color:#666">-1</span>])
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # Initial MARS Terms (quantitative)</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Range: [1, 21]</span>
</span></span></code></pre></div><h2 id="qualitative-parameters">Qualitative parameters</h2>
<p>Now let&rsquo;s look at an example of a qualitative parameter. If a model includes a data aggregation step, we want to allow users to tune how our parameters are aggregated.  For example, in embedding methods, possible values might be <code>min</code>, <code>max</code>, <code>mean</code>, <code>sum</code>, or to not aggregate at all (&ldquo;none&rdquo;). Since these cannot be put on a numeric scale, they are possible values of a qualitative parameter. We&rsquo;ll take &ldquo;character&rdquo; input (not &ldquo;logical&rdquo;), and we must specify the allowed values. By default we won&rsquo;t aggregate.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>aggregation <span style="color:#666">&lt;-</span> <span style="color:#00f">function</span>(values <span style="color:#666">=</span> <span style="color:#00f">c</span>(<span style="color:#ba2121">&#34;none&#34;</span>, <span style="color:#ba2121">&#34;min&#34;</span>, <span style="color:#ba2121">&#34;max&#34;</span>, <span style="color:#ba2121">&#34;mean&#34;</span>, <span style="color:#ba2121">&#34;sum&#34;</span>)) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">new_qual_param</span>(
</span></span><span style="display:flex;"><span>    type <span style="color:#666">=</span> <span style="color:#ba2121">&#34;character&#34;</span>,
</span></span><span style="display:flex;"><span>    values <span style="color:#666">=</span> values,
</span></span><span style="display:flex;"><span>    <span style="color:#408080;font-style:italic"># By default, the first value is selected as default. We&#39;ll specify that to</span>
</span></span><span style="display:flex;"><span>    <span style="color:#408080;font-style:italic"># make it clear.</span>
</span></span><span style="display:flex;"><span>    default <span style="color:#666">=</span> <span style="color:#ba2121">&#34;none&#34;</span>,
</span></span><span style="display:flex;"><span>    label <span style="color:#666">=</span> <span style="color:#00f">c</span>(aggregation <span style="color:#666">=</span> <span style="color:#ba2121">&#34;Aggregation Method&#34;</span>)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Within the dials package, the convention is to have the values contained in a separate vector whose name starts with <code>values_</code>. For example:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>values_aggregation <span style="color:#666">&lt;-</span> <span style="color:#00f">c</span>(<span style="color:#ba2121">&#34;none&#34;</span>, <span style="color:#ba2121">&#34;min&#34;</span>, <span style="color:#ba2121">&#34;max&#34;</span>, <span style="color:#ba2121">&#34;mean&#34;</span>, <span style="color:#ba2121">&#34;sum&#34;</span>)
</span></span><span style="display:flex;"><span>aggregation <span style="color:#666">&lt;-</span> <span style="color:#00f">function</span>(values <span style="color:#666">=</span> values_aggregation) {
</span></span><span style="display:flex;"><span>  <span style="color:#00f">new_qual_param</span>(
</span></span><span style="display:flex;"><span>    type <span style="color:#666">=</span> <span style="color:#ba2121">&#34;character&#34;</span>,
</span></span><span style="display:flex;"><span>    values <span style="color:#666">=</span> values,
</span></span><span style="display:flex;"><span>    <span style="color:#408080;font-style:italic"># By default, the first value is selected as default. We&#39;ll specify that to</span>
</span></span><span style="display:flex;"><span>    <span style="color:#408080;font-style:italic"># make it clear.</span>
</span></span><span style="display:flex;"><span>    default <span style="color:#666">=</span> <span style="color:#ba2121">&#34;none&#34;</span>,
</span></span><span style="display:flex;"><span>    label <span style="color:#666">=</span> <span style="color:#00f">c</span>(aggregation <span style="color:#666">=</span> <span style="color:#ba2121">&#34;Aggregation Method&#34;</span>)
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This step may not make sense if you are using the function in a script and not keeping it within a package.</p>
<p>We can use our <code>aggregation</code> parameters with dials functions.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">aggregation</span>()
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Aggregation Method  (qualitative)</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 5 possible value include:</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; &#39;none&#39;, &#39;min&#39;, &#39;max&#39;, &#39;mean&#39; and &#39;sum&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">aggregation</span>() <span style="color:#666">%&gt;%</span> <span style="color:#00f">value_sample</span>(<span style="color:#666">3</span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [1] &#34;min&#34;  &#34;sum&#34;  &#34;mean&#34;</span>
</span></span></code></pre></div><h2 id="session-information">Session information</h2>
<pre tabindex="0"><code>#&gt; ─ Session info ─────────────────────────────────────────────────────
#&gt;  setting  value
#&gt;  version  R version 4.1.2 (2021-11-01)
#&gt;  os       macOS Monterey 12.3
#&gt;  system   aarch64, darwin20
#&gt;  ui       X11
#&gt;  language (EN)
#&gt;  collate  en_GB.UTF-8
#&gt;  ctype    en_GB.UTF-8
#&gt;  tz       Europe/London
#&gt;  date     2022-04-11
#&gt;  pandoc   2.14.0.3 @ /Applications/RStudio.app/Contents/MacOS/pandoc/ (via rmarkdown)
#&gt; 
#&gt; ─ Packages ─────────────────────────────────────────────────────────
#&gt;  package    * version date (UTC) lib source
#&gt;  broom      * 0.7.12  2022-01-28 [1] CRAN (R 4.1.1)
#&gt;  dials      * 0.1.1   2022-04-06 [1] CRAN (R 4.1.2)
#&gt;  dplyr      * 1.0.8   2022-02-08 [1] CRAN (R 4.1.2)
#&gt;  ggplot2    * 3.3.5   2021-06-25 [1] CRAN (R 4.1.1)
#&gt;  infer      * 1.0.0   2021-08-13 [1] CRAN (R 4.1.1)
#&gt;  parsnip    * 0.2.1   2022-03-17 [1] CRAN (R 4.1.1)
#&gt;  purrr      * 0.3.4   2020-04-17 [1] CRAN (R 4.1.0)
#&gt;  recipes    * 0.2.0   2022-02-18 [1] CRAN (R 4.1.1)
#&gt;  rlang        1.0.2   2022-03-04 [1] CRAN (R 4.1.1)
#&gt;  rsample    * 0.1.1   2021-11-08 [1] CRAN (R 4.1.2)
#&gt;  scales     * 1.1.1   2020-05-11 [1] CRAN (R 4.1.2)
#&gt;  tibble     * 3.1.6   2021-11-07 [1] CRAN (R 4.1.1)
#&gt;  tidymodels * 0.2.0   2022-03-19 [1] CRAN (R 4.1.1)
#&gt;  tune       * 0.2.0   2022-03-19 [1] CRAN (R 4.1.2)
#&gt;  workflows  * 0.2.6   2022-03-18 [1] CRAN (R 4.1.2)
#&gt;  yardstick  * 0.0.9   2021-11-22 [1] CRAN (R 4.1.1)
#&gt; 
#&gt;  [1] /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/library
#&gt; 
#&gt; ────────────────────────────────────────────────────────────────────
</code></pre>
      </div>


      <div class="article-footer">
      
      <div style="float:left">
      
        <div class='itemTitle' align="left" style='font-size:.8em; line-height:2em'>Previous</div>
        <a href="/learn/develop/metrics/">Custom performance metrics</a>
      
      </div>
      
      
      <div style="float:right">
      
      <div class='itemTitle' align="right" style='font-size:.8em; line-height:2em'>Next</div>
        <a href="/learn/develop/broom/">Create your own broom tidier methods</a>
      
      </div>
     </div> 

      </div>

      <div class="column25">
        <div class="section hideOnMobile">
          <div class="sectionTitle">Contents</div>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#quantitative-parameters">Quantitative parameters</a></li>
    <li><a href="#qualitative-parameters">Qualitative parameters</a></li>
    <li><a href="#session-information">Session information</a></li>
  </ul>
</nav>
        </div>
      
        <div class="section">
          <div class="sectionTitle">Resources</div>
          




<div class="event">
  
  <div class="eventTitle">
    <a href="/find/"><i class="fas fa-search fa-xs"></i>&nbsp;&nbsp;Find</a>
  </div>
  <div class="eventDetails">Explore searchable tables of all tidymodels packages and functions.</div>
</div>






<div class="event">
  
  <div class="eventTitle">
    <a href="/books/"><i class="fas fa-book-open fa-xs"></i>&nbsp;&nbsp;Books</a>
  </div>
  <div class="eventDetails">Study up on statistics and modeling with our comprehensive books.</div>
</div>






<div class="event">
  
  <div class="eventTitle">
    <a href="https://www.tidyverse.org/tags/tidymodels/" target="_blank"><i class="fas fa-bullhorn fa-xs"></i>&nbsp;&nbsp;News</a>
  </div>
  <div class="eventDetails">Hear the latest about tidymodels packages at the <a href="https://www.tidyverse.org/tags/tidymodels/">tidyverse blog</a>.</div>
</div>



        </div>
      </div>
      


    </div>
  </div>  
</div> 


        <div id="rStudioFooter" class="band">
          <div class="bandContent">
            <div id="copyright">
              
              
              Proudly supported by <a class="rstudioLogo" href="https://www.rstudio.com/"></a>
              
            </div>
            <div id="logos">
              
              
            </div>
            
            <span class="float-right" aria-hidden="true">
              <a href="#" class="back-to-top">
                <span class="button_icon">
                  <i class="fas fa-chevron-up fa-2x"></i>
                </span>
              </a>
            </span>
            
          </div>
        </div>

      </div>  
    </div>  

    

    
<script src="/js/math-code.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-20375833-29', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>
</html>

</body>
</html>
