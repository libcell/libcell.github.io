<!DOCTYPE html>
<html>
<head>
<!DOCTYPE html>
<html lang="en-us">



<link rel="stylesheet" href="/css/fonts.css">
<link rel="stylesheet" href="/css/main-site.css">
<link rel="stylesheet" href="/css/fa5-all.css">
<style type="text/css">
    body {
	background-color: #ffffff;
	color: #404040
}

/* Links */

a {
  color: #CA225E;
}

a:hover {
  color: #cc3168;
}

/* Landing page content bands */

#homeContent .band.first {
  background-color: #ffffff
}

#homeContent .band.second {
  background-color: #fcfcfc
}

#homeContent .band.third {
  background-color: #ffffff
}

/* Top navigation bar menu */

#rStudioHeader {
  background-color: #ffffff;
  color: black;
}

#rStudioHeader .productName {
  color: #CA225E
}

#rStudioHeader .productName:hover {
  color: #00000075
}

#rStudioHeader #menu .menuItem.a {
  background-color: #75aadb;
  color: black;
}

#rStudioHeader #menu .menuItem:hover {
  background-color: white;
  color: #CA225E;
}

#rStudioHeader #menu .menuItem.current {
  background-color: #fcfcfc;
  color: #CA225E;
  text-decoration: none;
}

/* Footer */

#rStudioFooter.band {
  background-color: #CA225E40;
}

#rStudioFooter .bandContent #copyright {
  color: #CA225E;
}

/* Tables */

table tbody tr:nth-child(even){
  background-color: #fcfcfc;
}

table tbody tr:nth-child(odd){
  background-color: #1a162d10;
}

.latest {
  border-top: .5em solid <no value>;
}
</style>

  <link rel="stylesheet" href="/css/tm.css">




<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<meta name="apple-mobile-web-app-capable" content="yes" />

<meta name="og:image" content="https://www.tidymodels.org/images/feature_summary_large_image.jpg" >

  <meta property="twitter:card" content="summary_large_image">

<meta name="twitter:image" content="https://www.tidymodels.org/images/feature_summary_large_image.jpg" ><meta name="generator" content="Hugo 0.96.0" />

<meta property="og:type" content="website"><title>Learn - Model tuning via grid search</title>
    <meta property="og:title" content="Learn - Model tuning via grid search">
    
    
    
    
    <meta property="description" content="Choose hyperparameters for a model by training on a grid of many possible parameter values.
">
    <meta property="og:description" content="Choose hyperparameters for a model by training on a grid of many possible parameter values.
">



<link rel="apple-touch-icon" sizes="180x180" href="/images/favicons/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/images/favicons/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/images/favicons/favicon-16x16.png" />
<link rel="manifest" href="/images/favicons/site.webmanifest" />
<link rel="mask-icon" href="/images/favicons/safari-pinned-tab.svg" />
<link rel="shortcut icon" href="/images/favicons/favicon.ico" />
<meta name="msapplication-TileColor" content="#da532c">
<meta name="msapplication-config" href="/images/favicons/browserconfig.xml" >



<script type="text/javascript" src="/js/jquery-3.5.1.min.js"></script>
<script type="text/javascript" src="/js/site.js"></script>


  <script type="text/javascript" src="/js/tm.js"></script>


<link rel="icon" href="/images/favicon.ico" />


<script defer data-domain="tidymodels.org,all.tidymodels.org" src="https://plausible.io/js/plausible.js"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>


<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>



  <body>
    <div id="appTidyverseSite" class="shrinkHeader alwaysShrinkHeader">
      <div id="main">
        
        <div id="rStudioHeader">
          <div class="band">
            <div class="innards bandContent">
              <div>
                <a class="productName" href="/">Tidymodels</a>
                
              </div>
              <div id="menu">
  <div id="menuToggler"></div>
  <div id="menuItems" class="">
    
    
      
      
      
    <a class="menuItem " href="/packages/">Packages</a>
    
      
      
      
    <a class="menuItem " href="/start/">Get Started</a>
    
      
      
      
    <a class="menuItem current" href="/learn/">Learn</a>
    
      
      
      
    <a class="menuItem " href="/help/">Help</a>
    
      
      
      
    <a class="menuItem " href="/contribute/">Contribute</a>
    
      
      
      
    <a class="menuItem " href="/find/"><i class="fas fa-search fa-lg"></i> </a>
    
      
      
      
    <a class="menuItem " href="https://github.com/tidymodels/"><i class="fab fa-github fa-lg"></i></a>
    
  </div>
</div>

            </div>
          </div>
        </div>
</head>
<body>


 




<div class="band padForHeader pushFooter">
  <div class="bandContent">
    <div class="full splitColumns withMobileMargins">
      <div class="column75">
        
        <div class="section">
          <div class="sectionTitle">
            <a href="/learn/">
              <i class="fas fa-chevron-left"></i>&nbsp;Back to Learn
            </a>
          </div>
        </div>

      <h1 class="article-title">Model tuning via grid search</h1>

      
      <div class="article-header">
        </div>
        

      
      
      
      
        </p>
      
        
      <div class="learning-objective-container">
        <h2 class="learning-objective">Learning objective</h2>
        <p class="single-learning-objective-text">Choose hyperparameters for a model by training on a grid of many possible parameter values.</p>
      </div>
      

      <div class="article-content">
      <h2 id="introduction">Introduction</h2>
<p>To use the code in this article, you will need to install the following packages: kernlab, mlbench, and tidymodels.</p>
<p>This article demonstrates how to tune a model using grid search. Many models have <strong>hyperparameters</strong> that can&rsquo;t be learned directly from a single data set when training the model. Instead, we can train many models in a grid of possible hyperparameter values and see which ones turn out best.</p>
<h2 id="example-data">Example data</h2>
<p>To demonstrate model tuning, we&rsquo;ll use the Ionosphere data in the mlbench package:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">library</span>(tidymodels)
</span></span><span style="display:flex;"><span><span style="color:#00f">library</span>(mlbench)
</span></span><span style="display:flex;"><span><span style="color:#00f">data</span>(Ionosphere)
</span></span></code></pre></div><p>From <code>?Ionosphere</code>:</p>
<blockquote>
<p>This radar data was collected by a system in Goose Bay, Labrador. This system consists of a phased array of 16 high-frequency antennas with a total transmitted power on the order of 6.4 kilowatts. See the paper for more details. The targets were free electrons in the ionosphere. &ldquo;good&rdquo; radar returns are those showing evidence of some type of structure in the ionosphere. &ldquo;bad&rdquo; returns are those that do not; their signals pass through the ionosphere.</p>
</blockquote>
<blockquote>
<p>Received signals were processed using an autocorrelation function whose arguments are the time of a pulse and the pulse number. There were 17 pulse numbers for the Goose Bay system. Instances in this databse are described by 2 attributes per pulse number, corresponding to the complex values returned by the function resulting from the complex electromagnetic signal. See cited below for more details.</p>
</blockquote>
<p>There are 43 predictors and a factor outcome. Two of the predictors are factors (<code>V1</code> and <code>V2</code>) and the rest are numeric variables that have been scaled to a range of -1 to 1. Note that the two factor predictors have sparse distributions:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">table</span>(Ionosphere<span style="color:#666">$</span>V1)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;   0   1 </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  38 313</span>
</span></span><span style="display:flex;"><span><span style="color:#00f">table</span>(Ionosphere<span style="color:#666">$</span>V2)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;   0 </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 351</span>
</span></span></code></pre></div><p>There&rsquo;s no point of putting <code>V2</code> into any model since is is a zero-variance predictor. <code>V1</code> is not but it <em>could</em> be if the resampling process ends up sampling all of the same value. Is this an issue? It might be since the standard R formula infrastructure fails when there is only a single observed value:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">glm</span>(Class <span style="color:#666">~</span> ., data <span style="color:#666">=</span> Ionosphere, family <span style="color:#666">=</span> binomial)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic"># Surprisingly, this doesn&#39;t help: </span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#00f">glm</span>(Class <span style="color:#666">~</span> . <span style="color:#666">-</span> V2, data <span style="color:#666">=</span> Ionosphere, family <span style="color:#666">=</span> binomial)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; Error in `contrasts&lt;-`(`*tmp*`, value = contr.funs[1 + isOF[nn]]): contrasts can be applied only to factors with 2 or more levels</span>
</span></span></code></pre></div><p>Let&rsquo;s remove these two problematic variables:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>Ionosphere <span style="color:#666">&lt;-</span> Ionosphere <span style="color:#666">%&gt;%</span> <span style="color:#00f">select</span>(<span style="color:#666">-</span>V1, <span style="color:#666">-</span>V2)
</span></span></code></pre></div><h2 id="inputs-for-the-search">Inputs for the search</h2>
<p>To demonstrate, we&rsquo;ll fit a radial basis function support vector machine to these data and tune the SVM cost parameter and the <code>\(\sigma\)</code> parameter in the kernel function:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>svm_mod <span style="color:#666">&lt;-</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">svm_rbf</span>(cost <span style="color:#666">=</span> <span style="color:#00f">tune</span>(), rbf_sigma <span style="color:#666">=</span> <span style="color:#00f">tune</span>()) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">set_mode</span>(<span style="color:#ba2121">&#34;classification&#34;</span>) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">set_engine</span>(<span style="color:#ba2121">&#34;kernlab&#34;</span>)
</span></span></code></pre></div><p>In this article, tuning will be demonstrated in two ways, using:</p>
<ul>
<li>a standard R formula, and</li>
<li>a recipe.</li>
</ul>
<p>Let&rsquo;s create a simple recipe here:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>iono_rec <span style="color:#666">&lt;-</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">recipe</span>(Class <span style="color:#666">~</span> ., data <span style="color:#666">=</span> Ionosphere)  <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic"># remove any zero variance predictors</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_zv</span>(<span style="color:#00f">all_predictors</span>()) <span style="color:#666">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#408080;font-style:italic"># remove any linear combinations</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">step_lincomb</span>(<span style="color:#00f">all_numeric</span>())
</span></span></code></pre></div><p>The only other required item for tuning is a resampling strategy as defined by an rsample object. Let&rsquo;s demonstrate using basic bootstrapping:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">set.seed</span>(<span style="color:#666">4943</span>)
</span></span><span style="display:flex;"><span>iono_rs <span style="color:#666">&lt;-</span> <span style="color:#00f">bootstraps</span>(Ionosphere, times <span style="color:#666">=</span> <span style="color:#666">30</span>)
</span></span></code></pre></div><h2 id="optional-inputs">Optional inputs</h2>
<p>An <em>optional</em> step for model tuning is to specify which metrics should be computed using the out-of-sample predictions. For classification, the default is to calculate the log-likelihood statistic and overall accuracy. Instead of the defaults, the area under the ROC curve will be used. To do this, a yardstick package function can be used to create a metric set:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>roc_vals <span style="color:#666">&lt;-</span> <span style="color:#00f">metric_set</span>(roc_auc)
</span></span></code></pre></div><p>If no grid or parameters are provided, a set of 10 hyperparameters are created using a space-filling design (via a Latin hypercube). A grid can be given in a data frame where the parameters are in columns and parameter combinations are in rows. Here, the default will be used.</p>
<p>Also, a control object can be passed that specifies different aspects of the search. Here, the verbose option is turned off and the option to save the out-of-sample predictions is turned on.</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>ctrl <span style="color:#666">&lt;-</span> <span style="color:#00f">control_grid</span>(verbose <span style="color:#666">=</span> <span style="color:#008000;font-weight:bold">FALSE</span>, save_pred <span style="color:#666">=</span> <span style="color:#008000;font-weight:bold">TRUE</span>)
</span></span></code></pre></div><h2 id="executing-with-a-formula">Executing with a formula</h2>
<p>First, we can use the formula interface:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">set.seed</span>(<span style="color:#666">35</span>)
</span></span><span style="display:flex;"><span>formula_res <span style="color:#666">&lt;-</span>
</span></span><span style="display:flex;"><span>  svm_mod <span style="color:#666">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">tune_grid</span>(
</span></span><span style="display:flex;"><span>    Class <span style="color:#666">~</span> .,
</span></span><span style="display:flex;"><span>    resamples <span style="color:#666">=</span> iono_rs,
</span></span><span style="display:flex;"><span>    metrics <span style="color:#666">=</span> roc_vals,
</span></span><span style="display:flex;"><span>    control <span style="color:#666">=</span> ctrl
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>formula_res
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # Tuning results</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # Bootstrap sampling </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 30 × 5</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    splits            id          .metrics          .notes           .predictions</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    &lt;list&gt;            &lt;chr&gt;       &lt;list&gt;            &lt;list&gt;           &lt;list&gt;      </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  1 &lt;split [351/120]&gt; Bootstrap01 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  2 &lt;split [351/130]&gt; Bootstrap02 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  3 &lt;split [351/137]&gt; Bootstrap03 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  4 &lt;split [351/141]&gt; Bootstrap04 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  5 &lt;split [351/131]&gt; Bootstrap05 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  6 &lt;split [351/131]&gt; Bootstrap06 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  7 &lt;split [351/127]&gt; Bootstrap07 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  8 &lt;split [351/123]&gt; Bootstrap08 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  9 &lt;split [351/131]&gt; Bootstrap09 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 10 &lt;split [351/117]&gt; Bootstrap10 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # … with 20 more rows</span>
</span></span></code></pre></div><p>The <code>.metrics</code> column contains tibbles of the performance metrics for each tuning parameter combination:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>formula_res <span style="color:#666">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">select</span>(.metrics) <span style="color:#666">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">slice</span>(<span style="color:#666">1</span>) <span style="color:#666">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">pull</span>(<span style="color:#666">1</span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; [[1]]</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 10 × 6</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;        cost rbf_sigma .metric .estimator .estimate .config              </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;       &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt;                </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  1  0.00849  1.11e-10 roc_auc binary         0.815 Preprocessor1_Model01</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  2  0.176    7.28e- 8 roc_auc binary         0.839 Preprocessor1_Model02</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  3 14.9      3.93e- 4 roc_auc binary         0.870 Preprocessor1_Model03</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  4  5.51     2.10e- 3 roc_auc binary         0.919 Preprocessor1_Model04</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  5  1.87     3.53e- 7 roc_auc binary         0.838 Preprocessor1_Model05</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  6  0.00719  1.45e- 5 roc_auc binary         0.832 Preprocessor1_Model06</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  7  0.00114  8.41e- 2 roc_auc binary         0.969 Preprocessor1_Model07</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  8  0.950    1.74e- 1 roc_auc binary         0.984 Preprocessor1_Model08</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  9  0.189    3.13e- 6 roc_auc binary         0.832 Preprocessor1_Model09</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 10  0.0364   4.96e- 9 roc_auc binary         0.839 Preprocessor1_Model10</span>
</span></span></code></pre></div><p>To get the final resampling estimates, the <code>collect_metrics()</code> function can be used on the grid object:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span>estimates <span style="color:#666">&lt;-</span> <span style="color:#00f">collect_metrics</span>(formula_res)
</span></span><span style="display:flex;"><span>estimates
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 10 × 8</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;        cost rbf_sigma .metric .estimator  mean     n std_err .config            </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;       &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;              </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  1  0.00849  1.11e-10 roc_auc binary     0.822    30 0.00718 Preprocessor1_Mode…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  2  0.176    7.28e- 8 roc_auc binary     0.871    30 0.00525 Preprocessor1_Mode…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  3 14.9      3.93e- 4 roc_auc binary     0.916    30 0.00497 Preprocessor1_Mode…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  4  5.51     2.10e- 3 roc_auc binary     0.960    30 0.00378 Preprocessor1_Mode…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  5  1.87     3.53e- 7 roc_auc binary     0.871    30 0.00524 Preprocessor1_Mode…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  6  0.00719  1.45e- 5 roc_auc binary     0.871    30 0.00534 Preprocessor1_Mode…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  7  0.00114  8.41e- 2 roc_auc binary     0.966    30 0.00301 Preprocessor1_Mode…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  8  0.950    1.74e- 1 roc_auc binary     0.979    30 0.00204 Preprocessor1_Mode…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  9  0.189    3.13e- 6 roc_auc binary     0.871    30 0.00536 Preprocessor1_Mode…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 10  0.0364   4.96e- 9 roc_auc binary     0.871    30 0.00537 Preprocessor1_Mode…</span>
</span></span></code></pre></div><p>The top combinations are:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">show_best</span>(formula_res, metric <span style="color:#666">=</span> <span style="color:#ba2121">&#34;roc_auc&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 5 × 8</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;       cost rbf_sigma .metric .estimator  mean     n std_err .config             </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;      &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;               </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 1  0.950   0.174     roc_auc binary     0.979    30 0.00204 Preprocessor1_Model…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 2  0.00114 0.0841    roc_auc binary     0.966    30 0.00301 Preprocessor1_Model…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 3  5.51    0.00210   roc_auc binary     0.960    30 0.00378 Preprocessor1_Model…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 4 14.9     0.000393  roc_auc binary     0.916    30 0.00497 Preprocessor1_Model…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 5  0.00719 0.0000145 roc_auc binary     0.871    30 0.00534 Preprocessor1_Model…</span>
</span></span></code></pre></div><h2 id="executing-with-a-recipe">Executing with a recipe</h2>
<p>Next, we can use the same syntax but pass a <em>recipe</em> in as the pre-processor argument:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">set.seed</span>(<span style="color:#666">325</span>)
</span></span><span style="display:flex;"><span>recipe_res <span style="color:#666">&lt;-</span>
</span></span><span style="display:flex;"><span>  svm_mod <span style="color:#666">%&gt;%</span> 
</span></span><span style="display:flex;"><span>  <span style="color:#00f">tune_grid</span>(
</span></span><span style="display:flex;"><span>    iono_rec,
</span></span><span style="display:flex;"><span>    resamples <span style="color:#666">=</span> iono_rs,
</span></span><span style="display:flex;"><span>    metrics <span style="color:#666">=</span> roc_vals,
</span></span><span style="display:flex;"><span>    control <span style="color:#666">=</span> ctrl
</span></span><span style="display:flex;"><span>  )
</span></span><span style="display:flex;"><span>recipe_res
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # Tuning results</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # Bootstrap sampling </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 30 × 5</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    splits            id          .metrics          .notes           .predictions</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    &lt;list&gt;            &lt;chr&gt;       &lt;list&gt;            &lt;list&gt;           &lt;list&gt;      </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  1 &lt;split [351/120]&gt; Bootstrap01 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  2 &lt;split [351/130]&gt; Bootstrap02 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  3 &lt;split [351/137]&gt; Bootstrap03 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  4 &lt;split [351/141]&gt; Bootstrap04 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  5 &lt;split [351/131]&gt; Bootstrap05 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  6 &lt;split [351/131]&gt; Bootstrap06 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  7 &lt;split [351/127]&gt; Bootstrap07 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  8 &lt;split [351/123]&gt; Bootstrap08 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  9 &lt;split [351/131]&gt; Bootstrap09 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 10 &lt;split [351/117]&gt; Bootstrap10 &lt;tibble [10 × 6]&gt; &lt;tibble [0 × 3]&gt; &lt;tibble&gt;    </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # … with 20 more rows</span>
</span></span></code></pre></div><p>The best setting here is:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">show_best</span>(recipe_res, metric <span style="color:#666">=</span> <span style="color:#ba2121">&#34;roc_auc&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 5 × 8</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;      cost rbf_sigma .metric .estimator  mean     n std_err .config              </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;     &lt;dbl&gt;     &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt; &lt;chr&gt;                </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 1 15.6    0.182     roc_auc binary     0.981    30 0.00213 Preprocessor1_Model04</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 2  0.385  0.0276    roc_auc binary     0.978    30 0.00222 Preprocessor1_Model03</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 3  0.143  0.00243   roc_auc binary     0.930    30 0.00443 Preprocessor1_Model06</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 4  0.841  0.000691  roc_auc binary     0.892    30 0.00504 Preprocessor1_Model07</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 5  0.0499 0.0000335 roc_auc binary     0.872    30 0.00521 Preprocessor1_Model08</span>
</span></span></code></pre></div><h2 id="out-of-sample-predictions">Out-of-sample predictions</h2>
<p>If we used <code>save_pred = TRUE</code> to keep the out-of-sample predictions for each resample during tuning, we can obtain those predictions, along with the tuning parameters and resample identifier, using <code>collect_predictions()</code>:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">collect_predictions</span>(recipe_res)
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # A tibble: 38,740 × 8</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    id          .pred_bad .pred_good  .row    cost  rbf_sigma Class .config      </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;    &lt;chr&gt;           &lt;dbl&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;      &lt;dbl&gt; &lt;fct&gt; &lt;chr&gt;        </span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  1 Bootstrap01     0.333      0.667     1 0.00296 0.00000383 good  Preprocessor…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  2 Bootstrap01     0.333      0.667     9 0.00296 0.00000383 good  Preprocessor…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  3 Bootstrap01     0.333      0.667    10 0.00296 0.00000383 bad   Preprocessor…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  4 Bootstrap01     0.333      0.667    12 0.00296 0.00000383 bad   Preprocessor…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  5 Bootstrap01     0.333      0.667    14 0.00296 0.00000383 bad   Preprocessor…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  6 Bootstrap01     0.333      0.667    15 0.00296 0.00000383 good  Preprocessor…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  7 Bootstrap01     0.333      0.667    16 0.00296 0.00000383 bad   Preprocessor…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  8 Bootstrap01     0.334      0.666    22 0.00296 0.00000383 bad   Preprocessor…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt;  9 Bootstrap01     0.333      0.667    23 0.00296 0.00000383 good  Preprocessor…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; 10 Bootstrap01     0.334      0.666    24 0.00296 0.00000383 bad   Preprocessor…</span>
</span></span><span style="display:flex;"><span><span style="color:#408080;font-style:italic">#&gt; # … with 38,730 more rows</span>
</span></span></code></pre></div><p>We can obtain the hold-out sets for all the resamples augmented with the predictions using <code>augment()</code>, which provides opportunities for flexible visualization of model results:</p>
<div class="highlight"><pre tabindex="0" style=";-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-r" data-lang="r"><span style="display:flex;"><span><span style="color:#00f">augment</span>(recipe_res) <span style="color:#666">%&gt;%</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">ggplot</span>(<span style="color:#00f">aes</span>(V3, .pred_good, color <span style="color:#666">=</span> Class)) <span style="color:#666">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">geom_point</span>(show.legend <span style="color:#666">=</span> <span style="color:#008000;font-weight:bold">FALSE</span>) <span style="color:#666">+</span>
</span></span><span style="display:flex;"><span>  <span style="color:#00f">facet_wrap</span>(<span style="color:#666">~</span>Class)
</span></span></code></pre></div><img src="figs/augment-preds-1.svg" width="672" />
<h2 id="session-information">Session information</h2>
<pre tabindex="0"><code>#&gt; ─ Session info ─────────────────────────────────────────────────────
#&gt;  setting  value
#&gt;  version  R version 4.1.2 (2021-11-01)
#&gt;  os       macOS Monterey 12.3
#&gt;  system   aarch64, darwin20
#&gt;  ui       X11
#&gt;  language (EN)
#&gt;  collate  en_GB.UTF-8
#&gt;  ctype    en_GB.UTF-8
#&gt;  tz       Europe/London
#&gt;  date     2022-04-11
#&gt;  pandoc   2.14.0.3 @ /Applications/RStudio.app/Contents/MacOS/pandoc/ (via rmarkdown)
#&gt; 
#&gt; ─ Packages ─────────────────────────────────────────────────────────
#&gt;  package    * version date (UTC) lib source
#&gt;  broom      * 0.7.12  2022-01-28 [1] CRAN (R 4.1.1)
#&gt;  dials      * 0.1.1   2022-04-06 [1] CRAN (R 4.1.2)
#&gt;  dplyr      * 1.0.8   2022-02-08 [1] CRAN (R 4.1.2)
#&gt;  ggplot2    * 3.3.5   2021-06-25 [1] CRAN (R 4.1.1)
#&gt;  infer      * 1.0.0   2021-08-13 [1] CRAN (R 4.1.1)
#&gt;  kernlab    * 0.9-30  2022-04-02 [1] CRAN (R 4.1.2)
#&gt;  mlbench    * 2.1-3   2021-01-29 [1] CRAN (R 4.1.2)
#&gt;  parsnip    * 0.2.1   2022-03-17 [1] CRAN (R 4.1.1)
#&gt;  purrr      * 0.3.4   2020-04-17 [1] CRAN (R 4.1.0)
#&gt;  recipes    * 0.2.0   2022-02-18 [1] CRAN (R 4.1.1)
#&gt;  rlang        1.0.2   2022-03-04 [1] CRAN (R 4.1.1)
#&gt;  rsample    * 0.1.1   2021-11-08 [1] CRAN (R 4.1.2)
#&gt;  tibble     * 3.1.6   2021-11-07 [1] CRAN (R 4.1.1)
#&gt;  tidymodels * 0.2.0   2022-03-19 [1] CRAN (R 4.1.1)
#&gt;  tune       * 0.2.0   2022-03-19 [1] CRAN (R 4.1.2)
#&gt;  workflows  * 0.2.6   2022-03-18 [1] CRAN (R 4.1.2)
#&gt;  yardstick  * 0.0.9   2021-11-22 [1] CRAN (R 4.1.1)
#&gt; 
#&gt;  [1] /Library/Frameworks/R.framework/Versions/4.1-arm64/Resources/library
#&gt; 
#&gt; ────────────────────────────────────────────────────────────────────
</code></pre>
      </div>


      <div class="article-footer">
      
      <div style="float:left">
      
      </div>
      
      
      <div style="float:right">
      
      <div class='itemTitle' align="right" style='font-size:.8em; line-height:2em'>Next</div>
        <a href="/learn/work/nested-resampling/">Nested resampling</a>
      
      </div>
     </div> 

      </div>

      <div class="column25">
        <div class="section hideOnMobile">
          <div class="sectionTitle">Contents</div>
          <nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#example-data">Example data</a></li>
    <li><a href="#inputs-for-the-search">Inputs for the search</a></li>
    <li><a href="#optional-inputs">Optional inputs</a></li>
    <li><a href="#executing-with-a-formula">Executing with a formula</a></li>
    <li><a href="#executing-with-a-recipe">Executing with a recipe</a></li>
    <li><a href="#out-of-sample-predictions">Out-of-sample predictions</a></li>
    <li><a href="#session-information">Session information</a></li>
  </ul>
</nav>
        </div>
      
        <div class="section">
          <div class="sectionTitle">Resources</div>
          




<div class="event">
  
  <div class="eventTitle">
    <a href="/find/"><i class="fas fa-search fa-xs"></i>&nbsp;&nbsp;Find</a>
  </div>
  <div class="eventDetails">Explore searchable tables of all tidymodels packages and functions.</div>
</div>






<div class="event">
  
  <div class="eventTitle">
    <a href="/books/"><i class="fas fa-book-open fa-xs"></i>&nbsp;&nbsp;Books</a>
  </div>
  <div class="eventDetails">Study up on statistics and modeling with our comprehensive books.</div>
</div>






<div class="event">
  
  <div class="eventTitle">
    <a href="https://www.tidyverse.org/tags/tidymodels/" target="_blank"><i class="fas fa-bullhorn fa-xs"></i>&nbsp;&nbsp;News</a>
  </div>
  <div class="eventDetails">Hear the latest about tidymodels packages at the <a href="https://www.tidyverse.org/tags/tidymodels/">tidyverse blog</a>.</div>
</div>



        </div>
      </div>
      


    </div>
  </div>  
</div> 


        <div id="rStudioFooter" class="band">
          <div class="bandContent">
            <div id="copyright">
              
              
              Proudly supported by <a class="rstudioLogo" href="https://www.rstudio.com/"></a>
              
            </div>
            <div id="logos">
              
              
            </div>
            
            <span class="float-right" aria-hidden="true">
              <a href="#" class="back-to-top">
                <span class="button_icon">
                  <i class="fas fa-chevron-up fa-2x"></i>
                </span>
              </a>
            </span>
            
          </div>
        </div>

      </div>  
    </div>  

    

    
<script src="/js/math-code.js"></script>
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [['$','$'], ['\\(','\\)']],
    processEscapes: true
  }
});
</script>
<script async src="//cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML"></script>


    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-20375833-29', 'auto');
	
	ga('send', 'pageview');
}
</script>

  </body>
</html>

</body>
</html>
